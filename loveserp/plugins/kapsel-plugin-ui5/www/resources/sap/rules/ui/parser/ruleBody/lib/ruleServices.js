jQuery.sap.declare("sap.rules.ui.parser.ruleBody.lib.ruleServices");jQuery.sap.require("sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderInitiator");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.constants");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.ruleBodyServices");jQuery.sap.require("sap.rules.ui.parser.ruleBody.lib.constants");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");sap.rules.ui.parser.ruleBody.lib.ruleServices=sap.rules.ui.parser.ruleBody.lib.ruleServices||{};sap.rules.ui.parser.ruleBody.lib.ruleServices.lib=(function(){var R=sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector.lib.ResponseCollector;var r=R.getInstance();var a=sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib;var v=sap.rules.ui.parser.resources.vocabulary.lib.constants.lib;var b=sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderInitiator.lib;var c=new b.vocaDataProviderInitiatorLib();var d=sap.rules.ui.parser.ruleBody.lib.ruleBodyServices.lib;var e=new d.RuleBodyServicesLib();var f=sap.rules.ui.parser.ruleBody.lib.constants.lib;var D=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var O="rule";var g="rules";var h="id";var k="content";var l="name";var m="parameters";var n="usage";var o="RESULT";var p=function(i,j){var E=D.getOdataPropName(i,j);var F=null;if(E){F=i[E];}return F;};var q=function(i,j){var E=null;var F=null;E={"connection":null,"resourceID":i,"vocaLoadingType":v.vocaContextTypeEnum.JSON,"resourceContent":j};F=c.init(E);return F;};var s=function(i){var j=null;var E=i;if((E=p(E,f.EXECUTION_CONTEXT))&&(E=p(E,f.RESULT_DATA_OBJECT_ID))){j=E;}return j;};var t=function(j){var i=0;var E=null;var F=null;var G=null;var H=s(j);var I=j;if((I=p(I,f.VOCABULARY))&&(I=p(I,f.RULE_CONTENT))&&(I=p(I,f.DATA_OBJECTS))){var J=I;for(i=0;i<J.length;i++){E=J[i];if((I=p(E,f.ID))===H&&(I=p(E,n))===o){return true;}}}I=p(j,f.ID);G={"type":f.additionalInfoTypeEnum.executionContext};F=[H,I];r.addMessage("result_data_object_of_the_rule_services_is_not_valid",F,null,G);return false;};var u=function(j,E){var i=0;var F=null;var G=null;var H=null;var I=null;var J=null;var K=null;var L=null;var M=p(j,f.ID);var N=s(j);var P=p(j,f.RULES);if(N&&P){G=P;for(i=0;i<G.length;i++){F=G[i];if((P=p(F,f.RULE_CONTENT))&&(P=p(P,f.RESULT_DATA_OBJECT_ID))){J=P;if(J===N){continue;}if((K=p(F,h))&&(P=p(F,f.RULE_CONTENT))&&(L=p(P,l))){E[K]=L;}I={"ruleID":F[h],"type":f.additionalInfoTypeEnum.ruleResult};H=[J,K,N,M];r.addMessage("result_data_object_of_the_rule_is_not_valid",H,null,I);}}}};var w=function(E,F){var i=0;var j=0;var G=true;var H=null;var I=[];var J=[];var K=null;var L=null;var M=F.getParameters()||[];var N=p(E,f.EXECUTION_CONTEXT);var P=p(N,m)||[];var Q=p(E,f.ID);N=p(E,f.VOCABULARY);var S=p(N,f.ID);for(i=0;i<M.length;i++){H=M[i][f.ATTRIBUTES]||[];for(j=0;j<H.length;j++){I.push(H[j][f.PARAMETER_NAME]);}}for(i=0;i<P.length;i++){J.push(p(P[i],l));}for(i=0;i<I.length;i++){if(J.indexOf(I[i])===-1){G=false;L={"type":f.additionalInfoTypeEnum.executionContext};K=[I[i],S,Q];r.addMessage("execution_context_parameter_of_the_rule_services_is_not_valid",K,null,L);break;}}return G;};var x=function(i,j,E){var F={};var G=false;var H=false;E=E||{};F[f.RULE_STATUS]=f.RULE_ERROR;G=t(i);if(G){H=w(i,j);if(H){u(i,E);if(Object.keys(E).length===0){F[f.RULE_STATUS]=f.RULE_SUCCESS;}}}return F;};var y=function(i,j){if(!j){j={};}j[f.ODATA_FORMAT_PAYLOAD]={};j[f.ODATA_FORMAT_PAYLOAD][f.RULE_ID]=i;j[f.outputFlagsEnum.validationOutput]=false;j[f.outputFlagsEnum.rootObjectContextOutput]=true;};var z=function(i,j,E){var F={};var G=null;var H=null;var I=null;G=a.convertRuleODataToInternalModel(i);H=G[f.EXPLICIT_OUTPUT];y(p(i,h),F);I=e.process(G.ruleBody,j,E,F,H,null);return I;};var A=function(j,E,F){var i=0;var G=p(j,g);var H=null;var I=null;var J={};var K={};var L=null;J=x(j,F,K);if(!(J[f.RULE_STATUS]===f.RULE_ERROR&&Object.keys(K).length===0)){for(i=0;i<G.length;i++){H=G[i];L=p(H,h);if(!K[L]){I=z(p(H,k),E,F);if(I[f.RULE_STATUS]===f.RULE_ERROR){J=I;}}}}return J;};var B=function(i){var j=null;var E={};var F=null;var G=null;var H=p(i,O);var I=p(H,k);var J=p(i,f.VOCABULARY);if(!J){r.addMessage("voca_is_missing_in_the_payload",[],null,null);E[f.RULE_STATUS]=f.RULE_ERROR;}else{G=p(J,k);j=p(G,h);F=q(j,G);E=z(I,j,F);}return E;};var C=function(i){var j=null;var E=null;var F={};var G=null;var H=p(i,f.VOCABULARY);if(!H){r.addMessage("voca_is_missing_in_the_payload",[],null,null);F[f.RULE_STATUS]=f.RULE_ERROR;}else{E=p(H,k);j=p(E,h);G=q(j,E);F=A(i,j,G);}return F;};return{executeRuleValidation:B,executeRuleServiceValidation:C,validateRuleService:A,validateRule:z,validateExecutionContext:x};}());
