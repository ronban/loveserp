jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.utils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parserTokens");jQuery.sap.require("sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector");jQuery.sap.require("sap.rules.ui.parser.infrastructure.errorHandling.hrfException");sap.rules.ui.parser.businessLanguage.lib.parseUtils=sap.rules.ui.parser.businessLanguage.lib.parseUtils||{};sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib=(function(){var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var p=sap.rules.ui.parser.businessLanguage.lib.parserTokens.lib;var v=sap.rules.ui.parser.businessLanguage.lib.vocabularyUtils.lib;var a=new v.vocabularyUtilsLib();var u=new sap.rules.ui.parser.businessLanguage.lib.utils.lib();var R=sap.rules.ui.parser.infrastructure.messageHandling.lib.responseCollector.lib.ResponseCollector;var o=sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min.lib;var h=sap.rules.ui.parser.infrastructure.errorHandling.hrfException.lib;function b(){}b.prototype.DateFormatEnum={MMDDYYYY:1,DDMMYYYY:2,YYYYMMDD:3};b.prototype.TimeFormatEnum={HHMISS:1,HHMISSAMPM:2};b.prototype.isBlank=function(s){return(!s||/^\s*$/.test(s));};b.prototype.isAutocompleteMode=function(m){return(m===c.AUTOCOMPLETE_MODE_LOWERCASE||m===c.AUTOCOMPLETE_MODE);};b.prototype.isCollectionOperator=function(t){if(t===undefined||t===null){return false;}return(t===p.COUNT_DISTINCT_OF||t===p.COUNT_OF||t===p.LAST||t===p.MOST_RECENT||t===p.MAXIMUM_OF||t===p.HIGHEST||t===p.LOWEST||t===p.EARLIEST||t===p.MINIMUM_OF||t===p.NUMBER_OF||t===p.AVERAGE_OF||t===p.SUM_OF||t===p.FIRST||t===p.OF);};b.prototype.parseType=function(d,t){try{var e=t;if(typeof t==="undefined"||t===null){e=c.TYPE_ALL;}switch(e){case c.TYPE_ALL:d.model();break;case c.TYPE_BOOLEAN:d.modelBooleanPure();break;case c.TYPE_NUMERIC:d.modelNumric();break;case c.TYPE_STRING:d.modelString();break;case c.TYPE_DATE:d.modelDate();break;case c.TYPE_TIMESPAN:d.modelTimespan();break;case c.TYPE_TIMESTAMP:d.modelTimestamp();break;case c.TYPE_TIME:d.modelTime();break;case c.TYPE_SINGLE_EXPRESSION:d.modelSingleExpression();break;case c.TYPE_SINGLE_EXPRESSION_BOOLEAN:d.modelBooleanType();break;case c.TYPE_BOOLEAN_ENHANCED:d.modelBoolean();break;case c.TYPE_COLLECTION:d.modelCollection();break;case c.TYPE_BOOLEAN_COLLECTION:d.modelBooleanCollection();break;case c.TYPE_STRING_COLLECTION:d.modelStringCollection();break;case c.TYPE_NUMERIC_COLLECTION:d.modelNumricCollection();break;case c.TYPE_DATE_COLLECTION:d.modelDateCollection();break;case c.TYPE_TIMESPAN_COLLECTION:d.modelTimespanCollection();break;case c.TYPE_TIMESTAMP_COLLECTION:d.modelTimestampCollection();break;case c.TYPE_TIME_COLLECTION:d.modelTimeCollection();break;case c.TYPE_AUTOCOMPLETE:d.modelAllAutocomplete();break;case c.TYPE_NON_COLLECTION:d.modelNonCollection();break;default:throw new h.HrfException("ERROR: incorrect parst type!");}}catch(i){}};b.prototype.sortAndRemoveDuplicates=function(d){return d.sort().filter(function(i,e){return!e||i!==d[e-1];});};b.prototype.getSingleTokenType=function(t){var d=t;switch(t){case p.TYPENUMBERCOLLECTION:d=p.TYPENUMBER;break;case p.TYPEBOOLEANCOLLECTION:d=p.TYPEBOOLEAN;break;case p.TYPESTRINGCOLLECTION:d=p.TYPESTRING;break;case p.TYPEDATECOLLECTION:d=p.TYPEDATE;break;case p.TYPETIMECOLLECTION:d=p.TYPETIME;break;case p.TYPETIMESTAMPCOLLECTION:d=p.TYPETIMESTAMP;break;case p.TYPETIMEINTERVALCOLLECTION:d=p.TYPETIMEINTERVAL;break;}return d;};b.prototype.getNavigationPathFromTextPos=function(t,d){var n=t.substring(d);n=n.split(' ')[0];return n;};b.prototype.getNavigationObjectType=function(d){if(d===undefined||d===null||!d.isValid){return null;}var t=null;if(d.attribute.businessDataType===null&&d.root.businessDataType===null){t=p.TYPECOLLECTION;}else{var e=(d.root.isAlias)?d.root.businessDataType:d.attribute.businessDataType;var f=c.SIMPLE_SELECTION_VALUE_TYPE.getByValue("string",e);switch(f.string){case c.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPENUMBERDT:p.TYPENUMBERCOLLECTION;}else{t=p.TYPENUMBER;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPEBOOLEANDT:p.TYPEBOOLEANCOLLECTION;}else{t=p.TYPEBOOLEAN;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.STRING.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPESTRINGDT:p.TYPESTRINGCOLLECTION;}else{t=p.TYPESTRING;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.DATE.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPEDATEDT:p.TYPEDATECOLLECTION;}else{t=p.TYPEDATE;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.TIME.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPETIMEDT:p.TYPETIMECOLLECTION;}else{t=p.TYPETIME;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPETIMESTAMPDT:p.TYPETIMESTAMPCOLLECTION;}else{t=p.TYPETIMESTAMP;}break;case c.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string:if(d.isCollection){t=(d.root.isDTAlias)?p.TYPETIMEINTERVALDT:p.TYPETIMEINTERVALCOLLECTION;}else{t=p.TYPETIMEINTERVAL;}break;}}return t;};b.prototype.getStringArray=function(d){var s="\n [\n ";var i;for(i=0;i<d.length;i++){if(d[i]instanceof Object){s+=d[i].getString();}else{s+=d[i];}if(i===(d.length-1)){s+="\n ";}else{s+=",\n ";}}s+="]\n ";return s;};b.prototype.getNavigationParts=function(n){var d=[];var t;var r=0;while(r>-1){r=n.indexOf(".");if(r===-1){d.push(n);return d;}t=n.slice(0,r);d.push(t);n=n.slice(r+1);}return d;};b.prototype.getCollectionRelTypeFromBusinessDT=function(d){var r;switch(d){case c.TYPE_BOOLEAN:r=c.TYPE_BOOLEAN_COLLECTION;break;case c.TYPE_STRING:r=c.TYPE_STRING_COLLECTION;break;case c.TYPE_NUMERIC:r=c.TYPE_NUMERIC_COLLECTION;break;case c.TYPE_DATE:r=c.TYPE_DATE_COLLECTION;break;case c.TYPE_TIMESPAN:r=c.TYPE_TIMESPAN_COLLECTION;break;case c.TYPE_TIMESTAMP:r=c.TYPE_TIMESTAMP_COLLECTION;break;case c.TYPE_TIME:r=c.TYPE_TIME_COLLECTION;break;default:r=d;break;}return r;};b.prototype.getBusinessDTFromRelType=function(r){var d={};d[c.propertiesEnum.isCollection]=false;d[c.propertiesEnum.businessType]=r;switch(r){case c.TYPE_SINGLE_EXPRESSION_BOOLEAN:d[c.propertiesEnum.businessType]=c.TYPE_BOOLEAN;break;case c.TYPE_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=null;break;case c.TYPE_BOOLEAN_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_BOOLEAN;break;case c.TYPE_STRING_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_STRING;break;case c.TYPE_NUMERIC_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_NUMERIC;break;case c.TYPE_DATE_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_DATE;break;case c.TYPE_TIMESPAN_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_TIMESPAN;break;case c.TYPE_TIMESTAMP_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_TIMESTAMP;break;case c.TYPE_TIME_COLLECTION:d[c.propertiesEnum.isCollection]=true;d[c.propertiesEnum.businessType]=c.TYPE_TIME;break;default:}return d;};b.prototype.updateValueListTokenType=function(d,t,s,e,m){var f=m.getValueListAttribute();if(f){d.input.tokens[t].isFromValueList=true;d.input.tokens[t].valueListName=f.attributeValueList;}};b.prototype.getTokenTypeInfoForConstant=function(t){var i={};i.category=null;i.type=null;switch(t){case p.STRING:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_STRING;break;case p.INT:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_NUMERIC;break;case p.ZERO_TO_ONE:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_NUMERIC;break;case p.ZERO_OR_ONE:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_NUMERIC;break;case p.DECIMAL:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_NUMERIC;break;case p.TIMESTRING:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_TIME;break;case p.DATESTRING:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_DATE;break;case p.TIMESTAMPSTRING:i.category=c.tokenCategoryEnum.dynamic;i.type=c.TYPE_TIMESTAMP;break;case p.TRUE:i.category=c.tokenCategoryEnum.fixed;i.type=c.TYPE_BOOLEAN;break;case p.FALSE:i.category=c.tokenCategoryEnum.fixed;i.type=c.TYPE_BOOLEAN;break;case p.NULL:i.category=c.tokenCategoryEnum.fixed;i.type=null;break;default:break;}return i;};b.prototype.getTokenTypeInfoForReservedword=function(t){var i={};i.category=null;switch(t){case p.OR:case p.AND:i.category=c.tokenCategoryEnum.conjunctionOp;break;case p.EQ_SIGN:case p.NOT_EQUAL_SIGN:case p.GREATER_EQUAL_SIGN:case p.LESS_EQUAL_SIGN:case p.GREATER_SIGN:case p.LESS_SIGN:case p.IS_EQUAL:case p.IS_NOT_EQUAL:case p.IS_GREATER_THAN:case p.IS_LESS_THAN:case p.IS_EQUAL_OR_GREATER_THAN:case p.IS_EQUAL_OR_LESS_THAN:case p.IS_LIKE:case p.IS_NOT_LIKE:case p.CONTAINS:case p.CONTAINS_PATTERN:case p.DOES_NOT_CONTAIN:case p.START_WITH:case p.DOES_NOT_START:case p.END_WITH:case p.DOES_NOT_END:case p.IS_BEFORE:case p.BEFORE:case p.IS_NOT_BEFORE:case p.IS_AFTER:case p.AFTER:case p.IS_NOT_AFTER:case p.IS_IN_THE_LAST:case p.IS_NOT_IN_THE_LAST:case p.IS_IN_THE_NEXT:case p.IS_NOT_IN_THE_NEXT:i.category=c.tokenCategoryEnum.comparisonOp;break;case p.BETWEEN:case p.IS_BETWEEN:case p.IS_NOT_BETWEEN:i.category=c.tokenCategoryEnum.comparisonBetweenOp;break;case p.IN:case p.NOT_IN:case p.EXISTS_IN:case p.DOES_NOT_EXISTS_IN:i.category=c.tokenCategoryEnum.comparisonExistOp;break;case p.NUMBER_OF:case p.COUNT_DISTINCT_OF:case p.SUM_OF:case p.AVERAGE_OF:case p.LOWEST:case p.HIGHEST:case p.EARLIEST:case p.MOST_RECENT:i.category=c.tokenCategoryEnum.func;break;case p.CONCATENATE:case p.ROUND:case p.POWER:case p.SIN:case p.COS:case p.LOG:case p.WITH_FUZZY:i.category=c.tokenCategoryEnum.funcAdvances;break;case p.PLUS:case p.MINUS:case p.MULT:case p.DIV:i.category=c.tokenCategoryEnum.arithmeticOp;break;case p.TODAY:case p.TOMORROW:case p.YESTERDAY:i.category=c.tokenCategoryEnum.value;break;case p.SECOND:case p.MINUTE:case p.HOUR:case p.DAY:case p.WEEK:case p.MONTH:case p.YEAR:i.category=c.tokenCategoryEnum.UOM;break;case p.WITH_THE_HIGHEST:case p.WITH_THE_LOWEST:case p.WITH_THE_MOST_RECENT:case p.WITH_THE_EARLIEST:case p.SORTED_FROM_Z_TO_A_BY:case p.SORTED_FROM_A_TO_Z_BY:i.category=c.tokenCategoryEnum.sortingOp;break;case p.ALL_OF:case p.ANY_OF:i.category=c.tokenCategoryEnum.structuredCond;break;case p.WHERE:i.category=c.tokenCategoryEnum.filterOp;break;case p.GROUP_BY:case p.PER:i.category=c.tokenCategoryEnum.groupOp;break;default:break;}return i;};b.prototype.getTokenTypeMetadata=function(t,n,d,i,m){var r={};if(typeof t==="undefined"||t===null){return r;}switch(t){case p.WS:r.group=c.tokenTypesEnum.whitespace;break;case p.NAVIGATION:r.group=(d===o.antlr.runtime.Token.HIDDEN_CHANNEL)?c.tokenTypesEnum.vocabulary:c.tokenTypesEnum.unknown;break;case p.ANYCHAR:case p.COLON:r.group=c.tokenTypesEnum.unknown;break;case p.STRING:case p.INT:case p.ZERO_TO_ONE:case p.ZERO_OR_ONE:case p.DECIMAL:case p.TIMESTRING:case p.DATESTRING:case p.TIMESTAMPSTRING:case p.TRUE:case p.FALSE:case p.NULL:if(i){r.group=c.tokenTypesEnum.valueList;}else{r.group=c.tokenTypesEnum.constant;r.info=this.getTokenTypeInfoForConstant(t);}break;case p.TYPENUMBERCOLLECTION:case p.TYPENUMBER:case p.TYPEBOOLEANCOLLECTION:case p.TYPEBOOLEAN:case p.TYPESTRINGCOLLECTION:case p.TYPESTRING:case p.TYPEDATECOLLECTION:case p.TYPEDATE:case p.TYPETIMECOLLECTION:case p.TYPETIME:case p.TYPETIMESTAMPCOLLECTION:case p.TYPETIMESTAMP:case p.TYPETIMEINTERVALCOLLECTION:case p.TYPETIMEINTERVAL:case p.TYPECOLLECTION:case p.TYPEATTRIBUTE:r.group=c.tokenTypesEnum.vocabulary;var e=m.getCurrentNavigationObject(n);if(e!==undefined&&e!==null&&e.isValid){r.group=e.root.isAlias?c.tokenTypesEnum.alias:c.tokenTypesEnum.vocabulary;}break;case p.TYPENUMBERDT:case p.TYPEBOOLEANDT:case p.TYPESTRINGDT:case p.TYPEDATEDT:case p.TYPETIMEDT:case p.TYPETIMESTAMPDT:case p.TYPETIMEINTERVALDT:r.group=c.tokenTypesEnum.alias;r.info=this.getTokenTypeInfoForReservedword(t);break;case p.TYPENUMBERPARAMETER:case p.TYPESTRINGPARAMETER:case p.TYPEDATEPARAMETER:case p.TYPEBOOLEANPARAMETER:case p.TYPETIMEINTERVALPARAMETER:case p.TYPETIMEPARAMETER:case p.TYPETIMESTAMPPARAMETER:var f=m.getCurrentNavigationObject(n);if(f.isValid){r.group=c.tokenTypesEnum.parameter;}break;default:if(d===o.antlr.runtime.Token.HIDDEN_CHANNEL){r.group=c.tokenTypesEnum.vocabulary;}else{r.group=c.tokenTypesEnum.reservedWord;r.info=this.getTokenTypeInfoForReservedword(t);}break;}return r;};b.prototype.TokenInfo=function(t,d,i,s,e,f){this.start=s;this.end=e;this.tokenType=d;if(f){this.info={};this.info.key=f;}else if(i){this.info=i;}this.token=t;};b.prototype.buildTokenTypes=function(d,e,m){var t,f=[];var g=e.length;var j,s,k,l,q;var r=false;var w=null;var x=d.input.tokens;if(x.length===0){var n=e.length;t=new this.TokenInfo(e,c.tokenTypesEnum.unknown,null,0,n,null);f.push(t);}var i=0;for(i;i<x.length;i++){j=x[i];s=j.start;k=j.stop;r=(j.hasOwnProperty("isFromValueList")?j.isFromValueList:false);w=(j.hasOwnProperty("valueListName")?j.valueListName:null);l=e.substring(s,k+1);if(d.lexerErrorOccurred&&d.lexerErrorStartIndex===s){l=e.substring(s,g+1);t=new this.TokenInfo(l,c.tokenTypesEnum.unknown,null,s,g,null);f.push(t);break;}else{q=this.getTokenTypeMetadata(j.type,l,j.channel,r,m);t=new this.TokenInfo(l,q.group,q.info,s,k,w);f.push(t);}}return f;};b.prototype.parseWithValidation=function(l,d,t,m){this.overwriteLexerReportError(d,l,m);this.overwriteParserReportErrorValidateMode(d,m);this.parseType(d,t);};b.prototype.handleError=function(m,d,e){var t=(e.hasOwnProperty(c.propertiesEnum.flags)&&e.flags.hasOwnProperty(c.propertiesEnum.raiseError)&&e.flags[c.propertiesEnum.raiseError]===false)?false:true;if(d){var f=R.getInstance().getMessage(m,d);if(e.parseResult.errorDetails.indexOf(f)<0){if(t){R.getInstance().addMessage(m,d);}e.parseResult.errorDetails.push(f);}}e.parseResult.errorID=m;e.parseResult.status=c.statusEnum.ERROR;};b.prototype.handleWarning=function(m,d){if(!d||!this.isAutocompleteMode(d)){throw new h.HrfException(m);}};b.prototype.validateRootObjectContext=function(n,m){var i=0;if(m.flags[c.propertiesEnum.rootObjectContext]&&n.isValid&&!n.root.isAlias&&!n.modifiers.all){if(!m[c.propertiesEnum.rootObjectContext].name){m[c.propertiesEnum.rootObjectContext].name=n.root.name;}else if(m[c.propertiesEnum.rootObjectContext].name!==n.root.name){this.handleError("error_in_expression_root_object_validation_message",[m[c.propertiesEnum.rootObjectContext].name,n.root.name],m);throw new h.HrfException();}if(m[c.propertiesEnum.rootObjectContext].name){if(n.associations.path.length>0){var d=n.associations.path[0].name;if(!m[c.propertiesEnum.rootObjectContext].assocNames.hasOwnProperty(d)){m[c.propertiesEnum.rootObjectContext].assocNames[d]=true;var e=m.vocaRTServ.getAssociation(m.vocabulary,n.root.name,n.associations.path[0].name,true);if(a.isCardinalityCollection(e.cardinality)){for(i=0;i<e.attrs.length;i++){m[c.propertiesEnum.rootObjectContext].assocs.push(e.attrs[i].source);}}}}}}};b.prototype.getNavigationObjectFromPath=function(n,k,m){var d=m.getValueListAttribute();var e=m.vocabulary;var f=a.validateNavigationDetails(n,m.vocaRTServ,e,[],d);f.isParameter=false;m.setCurrentNavigationObject(k,f);this.validateRootObjectContext(f,m);return m.getCurrentNavigationObject(k);};b.prototype.endsWith=function(s,d){return s.indexOf(d,s.length-d.length)!==-1;};b.prototype.validateNumberOfArguments=function(d,e,f){if(d!==e){this.handleWarning(f+":  incompatible number of required arguments, exactly "+e.toString()+"arguments required.");return false;}return true;};b.prototype.validateArgumentExist=function(d,e){if(!d||!(typeof d==='object')){this.handleWarning(e+": incompatible number of required arguments.");return false;}return true;};b.prototype.validateArgumentType=function(d,e,f,g,j){var k=j+": "+e+" input arg must be instance of ";var l=false;var m;var i;for(i=0;i<f.length;++i){k+=g[i];if(i<f.length-1){k+=" or ";}m=f[i];if(d instanceof m){l=true;}}k+=".";if(!l){this.handleWarning(k);}return l;};b.prototype.validateArgumentsType=function(d,e,f){var g=this.validateArgumentExist(d,e);if(!g){return false;}var i,j,k;for(i=0;i<f.length;++i){j=f[i].name;if(!(d.hasOwnProperty(j))){if(f[i].required){this.handleWarning(e+": incompatible number of required arguments.");return false;}continue;}if(f[i].hasOwnProperty("type")){k=d[j];if(this.validateArgumentType(k,j,f[i].type,f[i].typeName,e)===false){g=false;}}}return g;};b.prototype.isEmptyString=function(s){if(/\S/.test(s)){return false;}return true;};b.prototype.getTokensStartWithString=function(d,s){var t=d.getTokenNames();var e=this.map;var r=[];var i,f,g;for(i=0;i<t.length;++i){f=t[i];g=(e.hasOwnProperty(f)?e[f]:f);if(g===undefined||g===null){continue;}g=g.toLowerCase();if(g.startsWith(s)){r.push(g);}}return r;};b.prototype.getTokensNames=function(d,e){var f=d.getTokenNames();var g=this.map;var r=[];var j=[];var k=u.removeDuplicate(e);var i,t,l,m,n,q;for(i=0;i<k.length;i++){t=k[i];if(t===undefined||t==='-1'||t===-1||t==='-2'||t===-2){continue;}l=f[t];if(l.indexOf("PARAMETER")!==-1||l.indexOf("TYPECOLLECTION")!==-1||l.indexOf("DT")!==-1){continue;}if(l.indexOf("COLLECTION")!==-1){m=l.split("COLLECTION");l=m[0];}n=(g.hasOwnProperty(l)?g[l]:l);if(n===undefined||n===null){continue;}n=n.toLowerCase();j.push("'"+n+"' ");q=n.split("type");if(q.length>1&&!g.hasOwnProperty(q[1])){r.push(" "+q[1]);}}r=this.sortAndRemoveDuplicates(r);if(r.length){r[0]=r[0].substring(1);if(r[0]==='date'||r[0]==='time'||r[0]==='timestamp'){r[0]="valid "+r[0];}}else if(j.length&&j.length<=3&&r.length===0){j[j.length-1]=j[j.length-1].replace(/\s?$/,'');return j;}return r;};b.prototype.isFirstErrorAfterWS=function(d){var e=d.input.tokens;var i;for(i=0;i<e.length;i++){if(e[i].type!==p.WS){break;}}if(i===d.errorIndex){return true;}return false;};b.prototype.getLastTokenTypeAndIgnoreWS=function(d){var e=d.input.tokens;var i=e.length;if(i===0){return-1;}for(i=i-1;i>=0;i--){if(e[i].type!==p.WS&&e[i].type!==p.NAVIGATION&&e[i].channel!==o.antlr.runtime.Token.HIDDEN_CHANNEL){break;}}return(i===-1)?-1:e[i].type;};b.prototype.getLastTokenAndIgnoreWS=function(d){var e=d.input.tokens;var i=e.length;if(i===0){return-1;}for(i=i-1;i>=0;i--){if(e[i].type!==p.WS&&e[i].channel!==o.antlr.runtime.Token.HIDDEN_CHANNEL){break;}}return(i===-1)?null:e[i];};b.prototype.isTokenOnlyPartOfRealToken=function(d,t){return(t===p.IS_A||t===p.EOF||(d.lexerErrorOccurred&&t===p.WS)||t===p.NAVIGATION||t===p.NOT||t===p.IS||t===p.DOES||t===p.AVERAGE||t===p.COUNTD||t===p.FILTER||t===p.SUM||t===p.ENDS||t===p.STARTS||t===p.MAXIMUM||t===p.MINIMUM||t===p.EXIST||t===p.EXISTS||t===p.TO||t===p.THE);};b.prototype.isLastTokenPartialText=function(d){var l=this.getLastTokenAndIgnoreWS(d);if(l===null){return false;}if(l.type===p.NAVIGATION||l.text===undefined){return true;}return(this.isTokenOnlyPartOfRealToken(d,l.type));};b.prototype.isErrorTokenPartialText=function(d,e){if(e===p.EOF){return false;}if(e===p.NAVIGATION){return true;}return(this.isTokenOnlyPartOfRealToken(d,e));};b.prototype.getTokenTypeOfFirstErrorAfterWS=function(e){var d=e.input.tokens;var i=e.token.index;while(i<d.length&&d[i].type===p.WS){i++;}return d[i].type;};b.prototype.hasWhiteSpace=function(s){var i=s.lastIndexOf(' ');return i>=0&&i!==(s.length-1);};b.prototype.overwriteParserReportErrorAutocompleteModeFailedDFA=function(d,e){var m=this;d.reportError=function(f){if(f.decisionNumber!==undefined&&u.isInArray(f.decisionNumber,this.DFA_decisions)){m.handleAllDFAOptions(d,f.decisionNumber);}else{e.isPartialText=e.isPartialText||m.isErrorTokenPartialText(this,f.c);}throw new h.HrfException();};};b.prototype.overwriteParserReportErrorValidateModeFailedDFA=function(d){var m=this;d.reportError=function(e){if(e.decisionNumber!==undefined&&u.isInArray(e.decisionNumber,this.DFA_decisions)){m.handleAllDFAOptions(d,e.decisionNumber);}else{if(e.charPositionInLine&&(e.charPositionInLine===-1||(d.errorIndex!==-1&&e.charPositionInLine>=d.errorIndex))){d.tokenError=d.getTokenErrorDisplay(e.token);d.errorTokenType=e.token.type;if((e.charPositionInLine===-1&&d.errorIndex!==-1)||(e.charPositionInLine!==-1&&e.charPositionInLine>d.errorIndex)){d.outputTokens.nextTokens=[];}d.errorIndex=e.charPositionInLine;}}throw new h.HrfException();};};b.prototype.isCollection=function(t){if(t===p.TYPEBOOLEANCOLLECTION||t===p.TYPETIMEINTERVALCOLLECTION||t===p.TYPENUMBERCOLLECTION||t===p.TYPESTRINGCOLLECTION||t===p.TYPEDATECOLLECTION||t===p.TYPETIMESTAMPCOLLECTION||t===p.TYPETIMECOLLECTION||t===p.TYPEBOOLEANDT||t===p.TYPETIMEINTERVALDT||t===p.TYPENUMBERDT||t===p.TYPESTRINGDT||t===p.TYPEDATEDT||t===p.TYPETIMESTAMPDT||t===p.TYPETIMEDT){return true;}return false;};b.prototype.overwriteParserReportErrorValidateMode=function(d,m){var e=this;d.reportError=function(A){m.parseResult.status=c.statusEnum.ERROR;var f=[];d.tokenError=null;d.errorIndex=null;d.errorTokenType=null;var g={};g.key="";g.args=[];if(A instanceof o.antlr.runtime.UnwantedTokenException&&A.expecting===-1){d.errorIndex=A.charPositionInLine;d.tokenError=d.getTokenErrorDisplay(A.getUnexpectedToken());g.key="error_in_expression_invalid_token_message";g.args[0]=d.tokenError;}else{if(A instanceof o.antlr.runtime.NoViableAltException){if(u.isInArray(A.decisionNumber,this.DFA_decisions)){e.handleFailedDFA(d,A);f=d.lastExpecting.expecting;}else{f=A.grammarDecisionDescription.slice();d.tokenError=(d.tokenError===null?d.getTokenErrorDisplay(A.token):d.tokenError);d.errorIndex=(d.errorIndex===null?A.charPositionInLine:d.errorIndex);}}else if(A instanceof o.antlr.runtime.MismatchedSetException){f=A.expecting.slice();d.errorIndex=A.charPositionInLine;d.tokenError=d.getTokenErrorDisplay(A.token);}else if(f.length===0&&A instanceof o.antlr.runtime.MismatchedTokenException){f.push(A.expecting);d.errorIndex=A.charPositionInLine;d.tokenError=d.getTokenErrorDisplay(A.token);}d.errorIndex=(d.errorIndex===null?0:d.errorIndex);if(d.errorIndex===0||e.isFirstErrorAfterWS(d)){if(e.isCollection(d.input.tokens[d.errorIndex].type)&&(!m.flags[c.propertiesEnum.isCollection])){g.key="error_in_expression_single_value_missing_message";g.args[0]=d.getTokenErrorDisplay(A.token);}else{g.key="error_in_expression_invalid_statement_message";g.args[0]=d.getTokenErrorDisplay(A.token);}}else if(d.tokenError!==null&&(d.tokenError.match("EOF")||d.tokenError.indexOf("EOF")!==-1)){g.key="incomplete_expression_message";}else{var i=d.errorTokenType!==null?d.errorTokenType:e.getTokenTypeOfFirstErrorAfterWS(A);var t=e.getTokensNames(d,f);if(t.length){g.key="error_in_expression_enter_suggestions_instead_message";g.args[0]=t;g.args[1]=d.tokenError;}else{g.key="error_in_expression_invalid_entry_message";g.args[0]=d.tokenError;}if((i!==null&&i!==undefined&&(e.isCollection(i)))&&(u.isInArray(p.TYPEBOOLEAN,f)||u.isInArray(p.TYPEDATE,f)||u.isInArray(p.TYPETIMEINTERVAL,f)||u.isInArray(p.TYPENUMBER,f)||u.isInArray(p.TYPESTRING,f)||u.isInArray(p.TYPETIME,f)||u.isInArray(p.TYPETIMESTAMP,f))){var j=d.getTokenNames()[i].toLowerCase();var k=j.split("collection");var l=k[0].split("type");l=l[1];l=(l==="date"?"valid date":l);if(u.isInArray(l+" ",t)||u.isInArray(" "+l,t)||u.isInArray(l,t)){g.key="error_in_expression_single_value_missing_message";g.args[0]=d.tokenError;}}}}m.parseResult.cursorPosition=d.errorIndex;e.handleError(g.key,g.args,m);throw new h.HrfException();};};b.prototype.overwriteLexerReportError=function(d,l,m){var e=this;l.reportError=function(A){m.parseResult.status=c.statusEnum.ERROR;d.lexerErrorStartIndex=A.input.markers[1].charPositionInLine;var f="";var g={};g.key="";g.args=[];if(d.lexerErrorOccurred===false){d.lexerErrorOccurred=true;if(A instanceof o.antlr.runtime.NoViableAltException||A instanceof o.antlr.runtime.MismatchedSetException){var j=d.input.tokens.length;var k=A.input.data;if(j>0){var s=d.input.tokens[j-1].stop+1;f=k.substring(s,A.charPositionInLine);}else{f=k.substring(0,A.charPositionInLine);}f=f.replace(/\s\s+/g,' ');}var n=e.getTokensStartWithString(d,f);n=e.sortAndRemoveDuplicates(n);var q="";var i=0;var r="";for(i=0;i<n.length;i++){q+=r+"'"+n[i]+"'";r=", ";}if(f.indexOf("EOF")!==-1){g.key="error_in_expression_missing_token_at_the_end_of_the_expression_message";g.args[0]=q;}else{g.key="error_in_expression_missing_token_message";g.args[0]=q;g.args[1]=f;}if(A instanceof o.antlr.runtime.MismatchedTokenException){g.args[0]=this.getCharErrorDisplay(A.expecting);if(this.getCharErrorDisplay(A.c).indexOf("EOF")!==-1){g.key="error_in_expression_missing_token_at_the_end_of_the_expression_message";}else{g.key="error_in_expression_missing_token_message";g.args[1]=this.getCharErrorDisplay(A.c);}}}m.parseResult.cursorPosition=A.charPositionInLine;e.handleError(g.key,g.args,m);throw new h.HrfException();};};b.prototype.zeroPad=function(n,d){var z=d-n.toString().length+1;return[].constructor(+(z>0&&z)).join("0")+n;};b.prototype.isDateString=function(s,d){s=s.replace(/[']+/g,'');var e=null;if(d===this.DateFormatEnum.MMDDYYYY){e=/^(0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])[\-\/.](19|20)\d\d$/;}else if(d===this.DateFormatEnum.DDMMYYYY){e=/^(0?[1-9]|[12][0-9]|3[01])[\-\/.](0?[1-9]|1[012])[\-\/.](19|20)\d\d$/;}else if(d===this.DateFormatEnum.YYYYMMDD){e=/^(19|20)\d\d[\-\/.](0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])$/;}return e.test(s);};b.prototype.isTimeString=function(s,t){s=s.replace(/[']+/g,'');var d=null;if(t===this.TimeFormatEnum.HHMISS){d=/^(T?)(?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)$/;}else if(t===this.TimeFormatEnum.HHMISSAMPM){d=/^(T?)(?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)( )+[AP]M$/;}return d.test(s);};b.prototype.isTimestampString=function(s,d,t){s=s.replace(/[']+/g,'');var e=null;if(d===this.DateFormatEnum.MMDDYYYY){if(t===this.TimeFormatEnum.HHMISS){e=/^(0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])[\-\/.](19|20)\d\d[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)$/;}else if(t===this.TimeFormatEnum.HHMISSAMPM){e=/^(0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])[\-\/.](19|20)\d\d[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)( )+[AP]M$/;}}else if(d===this.DateFormatEnum.DDMMYYYY){if(t===this.TimeFormatEnum.HHMISS){e=/^(0?[1-9]|[12][0-9]|3[01])[\-\/.](0?[1-9]|1[012])[\-\/.](19|20)\d\d[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)$/;}else if(t===this.TimeFormatEnum.HHMISSAMPM){e=/^(0?[1-9]|[12][0-9]|3[01])[\-\/.](0?[1-9]|1[012])[\-\/.](19|20)\d\d[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)( )+[AP]M$/;}}else if(d===this.DateFormatEnum.YYYYMMDD){if(this.timeFormat===this.TimeFormatEnum.HHMISS){e=/^(19|20)\d\d[\-\/.](0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)$/;}else if(t===this.TimeFormatEnum.HHMISSAMPM){e=/^(19|20)\d\d[\-\/.](0?[1-9]|1[012])[\-\/.](0?[1-9]|[12][0-9]|3[01])[\ \T](?:2[0-3]|[01]?[0-9]):[0-5][0-9]:[0-5][0-9](Z?)( )+[AP]M$/;}}return e.test(s);};b.prototype.convertTo24Hour=function(t){var n=t.toLowerCase();var d=parseInt(n.substr(0,2),10);if(n.indexOf('am')!==-1&&d===12){n=n.replace('12','0');}if(n.indexOf('pm')!==-1&&d<12){n=n.replace(d,(d+12));}return n.replace(/(am|pm)/,'');};b.prototype.buildHanaDateString=function(d,e,t){d=d.replace(/[']+/g,'');var s=d.split(/[\.\-\/T ]/);var f="";var g="00:00:00.000000";switch(e){case this.DateFormatEnum.MMDDYYYY:f=this.zeroPad(s[2],4)+"-"+this.zeroPad(s[0],2)+"-"+this.zeroPad(s[1],2);break;case this.DateFormatEnum.DDMMYYYY:f=this.zeroPad(s[2],4)+"-"+this.zeroPad(s[1],2)+"-"+this.zeroPad(s[0],2);break;case this.DateFormatEnum.YYYYMMDD:f=this.zeroPad(s[0],4)+"-"+this.zeroPad(s[1],2)+"-"+this.zeroPad(s[2],2);break;}var i=0;if(e!==""){i=3;}else if(d.indexOf('T')===0){i=1;}switch(t){case this.TimeFormatEnum.HHMISS:g=s[i]+".000000";break;case this.TimeFormatEnum.HHMISSAMPM:g=this.convertTo24Hour(s[i])+".000000";break;}var j="";if(f!==""){j=" ";}return"'"+f+j+g+"'";};b.prototype.updateTokenType=function(t,m){var r=t.type;var d=m.contextQueue.length;if(d===0){return r;}var e=m.contextQueue[d-1];if(e.root.isAlias||e.root.isParameter){return r;}var n=t.expression;if(t.type===p.NAVIGATION){var f=e.navigation.split(".");if(e.attribute.isValid){f.pop();}var g=(f.length===0)?e.navigation+"."+n:f.join(".")+"."+n;var j=this.getNavigationObjectFromPath(g,n,m);var k=this.getNavigationObjectType(j);if(k!==null){r=this.getSingleTokenType(k);return r;}}if(this.isCollection(n.type)){var l=n.split(".");n=l[0];if(e.root.name!==l[0]){return r;}var i=1;while(i<l.length&&i<=e.associations.path.length&&l[i]===e.associations.path[i-1].name){n=e.associations.path[i-1].object;i++;}for(i;i<l.length;i++){n=n+"."+l[i];}var q=a.validateNavigationDetails(n,m.vocaRTServ,m.vocabulary,[]);if(q.isCollection){return r;}r=this.getSingleTokenType(t.type);}return r;};b.prototype.map={ANY_OF:"any of the following conditions is true:",ALL_OF:"all of the following conditions are true:",BULLET:"<add line>",END_STRUCT:";",COLON:":",ANY:"any",CONDITIONS:"conditions",FOLLOWING:"following",OR:"or",AND:"and",LROUNDB:"(",RROUNDB:")",STRING:"<'string'>",DATESTRING:"<'dd/mm/yyyy'>",TIMESTAMPSTRING:"<'dd/mm/yyyy hh:mi:ss'>",TIMESTRING:"<'hh:mi:ss'>",ALL:"all ",PLUS:"+",MINUS:"-",WHERE:"where",FILTER:"filter",BY:"by",IS:"is",NOT:"not",THE:"the",LAST:"last",NEXT:"next",INT:"<number>",DECIMAL:"<number>",THIS:"this",TODAY:"today",YESTERDAY:"yesterday",TOMORROW:"tomorrow",BEFORE:"is before",AFTER:"is after",BETWEEN:"is between",TO:"to",SECOND:"seconds",MINUTE:"minutes",HOUR:"hours",DAY:"days",WEEK:"weeks",MONTH:"months",YEAR:"years",CONTAINS:"contains",STARTS:"starts",ENDS:"ends",WITH:"with",LIKE:"is like",EQUALS:"equals",IN:"exists in",NOT_SIGN:"!",EQ_SIGN:"=",NOT_EQUAL_SIGN:"!=",GREATER_EQUAL_SIGN:">=",LESS_EQUAL_SIGN:"<=",LESS:"less",GREATER:"greater",THAN:"than",AVERAGE:"average",OF:"of",SUM:"sum",COUNT:"count",COUNTD:"countd",DISTINCT:"distinct",FIRST:"first",ID:"ID",DOT:".",GROUP:"group",MULT:"*",DIV:"/",EQ:"eq",EQUAL:"equal",PER:"per",ONE:"one",DO:"do",EXISTS:"exists",GREATER_SIGN:">",COMMA:",",LESS_SIGN:"<",IS_GREATER_THAN:"is greater than",IS_LESS_THAN:"is less than",GREATER_THAN:"is greater than",LESS_THAN:"is less than",IS_EQUAL:"is equal to",IS_NOT_EQUAL:"is not equal to",DOES_NOT_EQUAL:"does not equal",NOT_EQUAL:"not equals",EXISTS_IN:"exists in",DOES_NOT_EXISTS_IN:"does not exist in",NOT_EXISTS_IN:"not exists in",IS_IN_THE:"is in the",IS_NOT_IN_THE:"is not in the",IN_THE:"in the",NOT_IN_THE:"not in the",IS_LIKE:"is like",IS_NOT_LIKE:"is not like",NOT_LIKE:"is not like",IS_IN:"is in",IS_NOT_IN:"is not in",NOT_IN:"does not exist in",DOES_NOT_CONTAIN:"does not contain",DOES_CONTAIN:"does contain",NOT_CONTAIN:"not contains",CONTAINS_PATTERN:"contains pattern",WITH_FUZZY:"with a fuzzy score of",ZERO_TO_ONE:"<value from 0 to 1>",ZERO_OR_ONE:"<0 or 1>",DOES_NOT_START:"does not start with",DOES_START:"does start with",NOT_START:"not starts with",START_WITH:"starts with",DOES_NOT_END:"does not end with",DOES_END:"does end with",NOT_END:"not ends with",COUNT_OF:"count of",COUNTD_OF:"countd of",COUNT_DISTINCT_OF:"count distinct of",IS_BEFORE:"is before",IS_AFTER:"is after",IS_NOT_BEFORE:"is not before",IS_NOT_AFTER:"is not after",IS_BETWEEN:"is between",IS_NOT_BETWEEN:"is not between",END_WITH:"ends with",MINIMUM_OF:"minimum of",MAXIMUM_OF:"maximum of",AVERAGE_OF:"average of",GROUP_BY:"grouped by",FILTER_BY:"filter by",SUM_OF:"sum of",IS_EQUAL_OR_LESS_THAN:"is equal or less than",IS_EQUAL_OR_GREATER_THAN:"is equal or greater than",GREATER_THAN_OR_EQUAL:"is equal or greater than",IS_IN_THE_LAST:"is in the last",IS_IN_THE_NEXT:"is in the next",IS_NOT_IN_THE_LAST:"is not in the last",IS_NOT_IN_THE_NEXT:"is not in the next",SORTED_BY:"sorted by",WITH_THE_EARLIEST:"with the earliest",WITH_THE_MOST_RECENT:"with the most recent",EARLIEST:"earliest",MOST_RECENT:"most recent",WITH_THE_HIGHEST:"with the highest",WITH_THE_LOWEST:"with the lowest",HIGHEST:"highest",LOWEST:"lowest",SORTED_FROM_A_TO_Z_BY:"sorted from A to Z by",SORTED_FROM_Z_TO_A_BY:"sorted from Z to A by",NUMBER_OF:"number of",NUMBER_OF_UNIQUE:"number of unique"};b.prototype.advancedFunctions={round:"round",power:"power",sin:"sin",cos:"cos",log:"log",'contains pattern':"textSearch",'with a fuzzy score of':"textSearch"};b.prototype.handleAllDFAOptions=function(d,e){var f='dfa'+e+'NumberOfAlt';var g='dfa'+e+'AltNumber';var j='failedPredictDFA'+e;var D='dfa'+e+'InRule';var m='dfa'+e+'Mark';d[j]=true;var i=0,r;for(i=1;i<(d[f]+1);i++){try{d.setPred(true);d[g]=i;d.input.rewind(d[m]);r=d[D];d[r+"_DFAcall"]=true;d[r]();}catch(k){}}};b.prototype.handleFailedDFA=function(d,e,f){if(d.mode===c.AUTOCOMPLETE_MODE||d.mode===c.AUTOCOMPLETE_MODE_LOWERCASE){this.overwriteParserReportErrorAutocompleteModeFailedDFA(d,f);}else if(d.mode===c.PARSE_MODE||d.mode===c.VALIDATE_MODE){this.overwriteParserReportErrorValidateModeFailedDFA(d);}this.handleAllDFAOptions(d,e.decisionNumber);};b.prototype.convertValueList=function(d,e,m,t,f){function g(r,x,_){var y={args:[]};if(r===null){y.key="error_in_expression_invalid_value_from_list_message";y.args[0]=x.token.slice(1,-1);y.args[1]=x.info.key;m.parseResult.cursorPosition=x.start;m.parseResult.convertedExpression=null;_.handleError(y.key,y.args,m);throw new h.HrfException();}}function j(w,x,_){var y={args:[]};y.key="techincal_error";y.args[0]=w.message;m.parseResult.cursorPosition=x.start;m.parseResult.convertedExpression=null;_.handleError(y.key,y.args,m);throw new h.HrfException();}var k=f;var l=m.flags[c.propertiesEnum.conversionOutput];var n=(l===c.conversionOutputEnum.toKeys);var q=0;var r="";var i;var s;for(i=0;i<t.length;i++){if(t[i].tokenType===c.tokenTypesEnum.valueList&&d.IsValueListDescriptionExist(e,t[i].info.key)){s=t[i].info.key;try{r=(n?d.GetValueFromValueListDescription(e,s,t[i].token):d.GetDescriptionFromValueListValue(e,s,t[i].token));}catch(w){j(w,t[i],this);}g(r,t[i],this);r=(r.indexOf("'")!==0)?"'"+r+"'":r;k=k.slice(0,t[i].start+q)+r+k.slice(t[i].end+1+q);q+=r.length-t[i].token.length;}}return k;};return{parseUtilsLib:b};}());
