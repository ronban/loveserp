/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/rta/controlAnalyzer/Base','sap/ui/rta/Utils','sap/ui/dt/ElementUtil','sap/ui/core/StashedControlSupport'],function(B,U,E,S){"use strict";var O=B.extend("sap.ui.rta.controlAnalyzer.ObjectPage",{metadata:{library:"sap.ui.rta"}});O.prototype.setControl=function(c){var o=U.getClosestTypeForControl(c,"sap.uxap.ObjectPageLayout");this.setProperty("control",o,true);this.setProperty("selectedControl",c,true);};O.prototype.getSelectedBlock=function(c){return U.findSupportedBlock(c,["sap.uxap.ObjectPageLayout"]);};O.prototype.getClosestType=function(c){return U.getClosestTypeForControl(c,"sap.uxap.ObjectPageLayout");};O.prototype.getControlsFieldCollection=function(c){throw new Error('getControlsFieldCollection not yet implemented in ObjectPage');};O.prototype.createChangeData=function(c,C,h,s){var m={};var b=c.getBindingContext().getObject();var a=b.controlId?b.controlId:b.fieldLabel;var o=sap.ui.getCore().byId(a);var d=!!o;var f=function(){if(d){if(b.visibilityType==="hide"){m={controlId:a,changeType:h?"hideControl":"unhideControl"};}else if(b.visibilityType==="stash"){var e=U.getObjectPageSections(C);var t=U.determineTargetIndex(s,C,e,1);m={controlId:a,changeType:h?"stashControl":"unstashControl",parentAggregationName:"sections",iTargetIndex:t};}}return m;};return new Promise(function(r,e){r(f());});};O.prototype.findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var f={};var F={};var e=E.findAllPublicElements(c);var i=0;for(i=0;i<e.length;i++){var o=e[i];if(o instanceof sap.m.ObjectAttribute){v.push(o.getBindingPath("text"));}}return{visibleAndBoundFields:v,fieldsAndLabelNames:f,fieldsAndBoundPropertyName:F};};O.prototype.prepare=function(){var c=this.getControl();var s=U.getObjectPageSections(c);if(!this.getPrepared()){for(var i=0;i<s.length;i++){var t=s[i].getTitle?s[i].getTitle():s[i].getId();if(s[i].getStashed&&(s[i].getStashed()||s[i].getVisible()===false)){this._mAvailableElements[s[i].getId()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"stash"};}else if(s[i].getVisible&&s[i].getVisible()===false){this._mAvailableElements[s[i].getTitle()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"hide"};}else{this._mHiddenElements[s[i].getTitle()]={fieldLabel:t,quickInfo:t,entityType:"",controlId:s[i].getId(),visibilityType:"hide"};}}sap.ui.rta.controlAnalyzer.Base.prototype.prepare.apply(this);}return Promise.resolve();};O.prototype.checkTargetZone=function(p,a,m){if(E.isInstanceOf(m,"sap.uxap.ObjectPageSection")){if(E.isInstanceOf(p,"sap.uxap.ObjectPageLayout")){if(m.getParent()===p&&a==="sections"){return true;}}}};O.prototype.isHideable=function(e){return(E.isInstanceOf(e,"sap.uxap.ObjectPageSection")&&!this.isMandatory(e));};return O;},true);
