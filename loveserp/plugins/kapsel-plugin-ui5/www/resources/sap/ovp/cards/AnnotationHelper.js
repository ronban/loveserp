// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ui.core.format.DateFormat");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};sap.ovp.cards.AnnotationHelper.NumberFormatFunctions={};sap.ovp.cards.AnnotationHelper.DateFormatFunctions={};sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions={};sap.ovp.cards.AnnotationHelper.criticalityConstants={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};function g(i,k){if(i.getSetting){var j=i.getSetting("_ovpCache");if(j){return j[k];}}return undefined;}function s(i,k,j){if(i.getSetting){var f1=i.getSetting("_ovpCache");if(f1){f1[k]=j;}}}function a(i,j){if(!sap.ovp.cards.AnnotationHelper.formatFunctions[j]){sap.ovp.cards.AnnotationHelper.formatFunctions[j]=0;}sap.ovp.cards.AnnotationHelper.formatFunctions[j]++;var k=j+sap.ovp.cards.AnnotationHelper.formatFunctions[j];sap.ovp.cards.AnnotationHelper.formatFunctions[k]=i;return"sap.ovp.cards.AnnotationHelper.formatFunctions."+k;}function c(i,j){var k;if(j){k=j.None;if(i&&i.EnumMember){var f1=i.EnumMember;if(e(f1,'Negative')){k=j.Negative;}else if(e(f1,'Critical')){k=j.Critical;}else if(e(f1,'Positive')){k=j.Positive;}}}return k;}function b(i){if(i=="Error"){i=1;}else if(i=="Warning"){i=2;}else if(i=="Success"){i=3;}else{i=0;}return i;}function e(i,j){return i&&i.indexOf(j,i.length-j.length)!==-1;}function d(i,j,k,f1,g1,h1,i1){var j1={};j1.EnumMember="None";if(i!==undefined){i=Number(i);if(e(j,"Minimize")||e(j,"Minimizing")){if((h1!==undefined&&h1!==null)&&(f1!=undefined&&f1!=null)){if(i<=h1){j1.EnumMember="Positive";}else if(i>f1){j1.EnumMember="Negative";}else{j1.EnumMember="Critical";}}}else if(e(j,"Maximize")||e(j,"Maximizing")){if((g1!==undefined&&g1!==null)&&(k!==undefined&&k!==null)){if(i>=g1){j1.EnumMember="Positive";}else if(i<k){j1.EnumMember="Negative";}else{j1.EnumMember="Critical";}}}else if(e(j,"Target")){if((h1!==undefined&&h1!==null)&&(f1!=undefined&&f1!=null)&&(g1!==undefined&&g1!==null)&&(k!==undefined&&k!==null)){if(i>=g1&&i<=h1){j1.EnumMember="Positive";}else if(i<k||i>f1){j1.EnumMember="Negative";}else{j1.EnumMember="Critical";}}}}return c(j1,i1);}function f(i,j,k,f1){if(!i||!j){return;}i=Number(i);if(!k&&(i-j>=0)){return"sap-icon://trend-up";}if(!f1&&(i-j<=0)){return"sap-icon://trend-down";}if(j&&k&&(i-j>=k)){return"sap-icon://trend-up";}if(j&&f1&&(i-j<=f1)){return"sap-icon://trend-down";}}function h(i,j){var k=i.getPath()+"-DataFields-Sorted";var f1=g(i,k);if(!f1){var g1=l(i,j);var h1=g1.map(function(i1){return i1.Value.Path;});h1=h1.filter(function(i1){return!!i1;});f1=j.filter(function(i1){if(i1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&h1.indexOf(i1.Value.Path)===-1){return true;}return false;});f1=p(f1);s(i,k,f1);}return f1;}function l(j,k){var f1=j.getPath()+"-DataPoints-Sorted";var g1=g(j,f1);if(!g1){g1=k.filter(m);g1=p(g1);var h1;for(var i=0;i<g1.length;i++){h1=j.getPath().substr(0,j.getPath().lastIndexOf("/")+1);g1[i]=j.getModel().getProperty(n(h1,g1[i]));h1="";}s(j,f1,g1);}return g1;}function m(i){if(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;}function n(i,j){if(i&&!e(i,'/')){i+='/';}return i+j.Target.AnnotationPath.slice(1);}function o(i){var j,k;if(i["com.sap.vocabularies.UI.v1.Importance"]){j=i["com.sap.vocabularies.UI.v1.Importance"].EnumMember;switch(j){case"com.sap.vocabularies.UI.v1.ImportanceType/High":k=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":k=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":k=3;break;}}else{k=4;}return k;}function p(i){if(i.length<2){return i;}var j=parseInt(i.length/2,10);var k=i.slice(0,j);var f1=i.slice(j,i.length);return q(p(k),p(f1));}function q(i,j){var k=[];while(i.length&&j.length){var f1=o(i[0]),g1=o(j[0]);if(f1<=g1){k.push(i.shift());}else{k.push(j.shift());}}while(i.length){k.push(i.shift());}while(j.length){k.push(j.shift());}return k;}function r(i,j,k){var f1=h(i,j)[k];if(f1){return y(i,f1);}return"";}function t(i,j,k){var f1=h(i,j)[k];if(f1){return f1.Label.String;}return"";}function u(i,j,k){var f1=l(i,j)[k];if(f1&&f1.Title){return f1.Title.String;}return"";}function v(i,j,k){var f1=l(i,j)[k];if(!f1){return"";}var g1=i.getSetting('ovpCardProperties');var h1=g1.getProperty("/entityType");var i1=g1.getProperty("/metaModel");return _(i,f1,h1,i1);}function w(i,j,k){var f1=l(i,j)[k];if(f1&&f1.Criticality){return true;}}function x(i,j,k){var f1=l(i,j)[k];var g1=f1.Criticality.Path;return"{path:'"+g1+"'}";}function _(i,j,k,f1){if(!j||!j.Value){return"";}var g1=i.getSetting('ovpCardProperties');var h1=false;if(g1){var i1=g1.getProperty("/ignoreSapText");h1=i1==undefined?h1:i1;}var j1=f1.getODataProperty(k,j.Value.Path);var k1=false;if(h1==true){if(j1&&j1["sap:aggregation-role"]=="measure"){k1=true;}}if(!k1){if(j1&&j1["sap:text"]){j1=f1.getODataProperty(k,j1["sap:text"]);j={Value:{Path:j1.name}};}}return y(i,j);}function y(i,j,k,f1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var g1=i.getSetting('ovpCardProperties');var h1=g1.getProperty("/entityType");var i1=g1.getProperty("/metaModel");return z(i,j,h1,i1,k,f1);}function z(i,j,k,f1,g1,h1,i1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var j1=f1.getODataProperty(k,j.Value.Path),k1="",l1;if(!h1){if(j.Value.Path.split("/").length>1){j1=G(f1,k,j.Value.Path);}if(!j1){return"";}if(j1["type"]==='Edm.DateTime'||j1["type"]==='Edm.DateTimeOffset'){var m1=i.getSetting('ovpCardProperties').oData.showDateInRelativeFormat;l1=D("dateFormatFunction",m1);k1=A([j.Value.Path?j.Value.Path:j1.name],l1);}else if((j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)||j1["scale"]){var n1=(j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)?j.ValueFormat.NumberOfFractionalDigits.Int:0,o1=j1["sap:unit"],p1=o1?f1.getODataProperty(k,o1):null,q1=[j.Value.Path?j.Value.Path:j1.name];if(n1>2){n1=2;}if(j1["Org.OData.Measures.V1.ISOCurrency"]){var r1=j1["Org.OData.Measures.V1.ISOCurrency"];if(r1.Path){l1=E(n1);q1.push(r1.Path);}else if(r1.String){l1=E(n1,r1.String);}}else if(p1&&p1["sap:semantics"]==="currency-code"){l1=E(n1);q1.push(o1);}else{l1=B(n1);}k1=A(q1,l1);}else{if(i1){k1=sap.ui.model.odata.AnnotationHelper.simplePath(i,j.Value);}else{k1=sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}}if(j1["Org.OData.Measures.V1.Unit"]){var s1=j1["Org.OData.Measures.V1.Unit"];if(s1.Path){k1+=(" "+A([s1.Path]));}else if(s1.String){k1+=(" "+s1.String);}}}if(!g1){if(j1["Org.OData.Measures.V1.ISOCurrency"]){var r1=j1["Org.OData.Measures.V1.ISOCurrency"];if(r1.Path){k1+=(" "+A([r1.Path]));}else if(r1.String){k1+=(" "+r1.String);}}}if(k1[0]===" "){k1=k1.substring(1);}return k1;}function A(j,k){var f1="",g1=j.length;if(g1>1){f1="{parts:[";for(var i=0;i<g1;i++){f1+=("{path: '"+j[i]+"'}"+((i===g1-1)?"]":", "));}}else{f1="{path: '"+j[0]+"'";}f1+=(k?(", formatter: '"+k+"'"):"")+"}";return f1;}function B(i){var j="formatNumberCalculation"+i;if(!sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]){sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]=C(Number(i));}return"sap.ovp.cards.AnnotationHelper.NumberFormatFunctions."+j;}function C(i){return function(j){var k=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});return k.format(Number(j));};}function D(i,j){var k={'relative':true,'relativeScale':'auto'};if(j!==undefined&&!j){k={'style':'medium'};}if(!sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]){sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]=function(f1){var g1=sap.ui.core.format.DateFormat.getInstance(k);if(!f1){f1="";}return g1.format(new Date(f1));};}return"sap.ovp.cards.AnnotationHelper.DateFormatFunctions."+i;}function E(i,j){var k="formatCurrencyCalculation"+(j?j+i:i);if(!sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]){sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]=F(i,j);}return"sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions."+k;}function F(i,j){return function(k,f1){var g1="";var h1=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});if(f1){g1=h1.format(k,f1);}else{g1=j?h1.format(k,j):h1.format(k);}return g1;};}function G(j,k,f1){var g1=f1.split("/");if(g1.length>1){for(var i=0;i<(g1.length-1);i++){var h1=j.getODataAssociationEnd(k,g1[i]);if(h1){k=j.getODataEntityType(h1.type);}}return j.getODataProperty(k,g1[g1.length-1]);}}function H(i,j,k){var f1=l(i,j);var g1="None";if(f1.length>k){var h1=f1[k];if(h1&&h1.Criticality){g1=I(i,h1);}else{g1=K(i,h1,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);}}return g1;}function I(i,j){var k=sap.ui.core.ValueState.None;var f1;var g1=j.Criticality;if(g1){f1="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+sap.ui.core.ValueState.Error+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+sap.ui.core.ValueState.Warning+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+sap.ui.core.ValueState.Success+"'' : "+"''"+sap.ui.core.ValueState.None+"'' '}'";if(g1.Path){var h1='$'+sap.ui.model.odata.AnnotationHelper.simplePath(i,g1);k=jQuery.sap.formatMessage(f1,h1);}else if(g1.EnumMember){var i1="'"+g1.EnumMember+"'";k=jQuery.sap.formatMessage(f1,i1);}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return k;}function J(i,j,k){var f1=l(i,j);var g1="None";if(f1.length>k){var h1=f1[k];if(h1&&h1.Criticality&&h1.Criticality.Path){g1=x(i,j,k);}else{g1=K(i,h1,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);g1=b(g1);}}return g1;}function K(i,j,k){var f1=k.None;if(j.Criticality){f1=c(j.Criticality,k);}else if(j.CriticalityCalculation&&j.Value&&j.Value&&j.Value.Path){f1=L(i,j,k);}return f1;}function L(i,j,k){var f1=W(j.Value);var g1=j.CriticalityCalculation.ImprovementDirection.EnumMember;var h1=W(j.CriticalityCalculation.DeviationRangeLowValue);var i1=W(j.CriticalityCalculation.DeviationRangeHighValue);var j1=W(j.CriticalityCalculation.ToleranceRangeLowValue);var k1=W(j.CriticalityCalculation.ToleranceRangeHighValue);var l1=M(h1);var m1=M(i1);var n1=M(j1);var o1=M(k1);var p1="parts: ["+f1;p1+=l1?","+h1:"";p1+=m1?","+i1:"";p1+=n1?","+j1:"";p1+=o1?","+k1:"";p1+="]";var q1=function(){var s1=1;return d(arguments[0],g1,l1?arguments[s1++]:h1,m1?arguments[s1++]:i1,n1?arguments[s1++]:j1,o1?arguments[s1++]:k1,k);};var r1=a(q1,"formatCriticalityCalculation");return"{"+p1+", formatter: '"+r1+"'}";}function M(i){return(typeof i==="string")&&i.charAt(0)==="{";}function N(j,k,f1){var g1="";var h1=f1.split("/");if(h1.length>1){for(var i=0;i<(h1.length-1);i++){var i1=j.getODataAssociationEnd(k,h1[i]);if(i1){k=j.getODataEntityType(i1.type);if(g1){g1=g1+"/";}g1=g1+h1[i];}else{return g1;}}}return g1;}sap.ovp.cards.AnnotationHelper.formatField=function(i,j){return y(i,j);};sap.ovp.cards.AnnotationHelper.formatItems=function(i,j){var k=i.getSetting('ovpCardProperties');var f1=k.getProperty("/addODataSelect");var g1=k.getProperty("/metaModel");var h1=g1.getODataEntityType(j.entityType);var i1=h1[k.getProperty('/selectionAnnotationPath')];var j1=h1[k.getProperty('/presentationAnnotationPath')];var k1="/"+j.name;var l1=Array.prototype.slice.call(arguments,2);if(i1){if(i1&&i1.Parameters&&i1.Parameters.length>0){k1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(i.getSetting('dataModel'),j,i1);}}var m1="{path: '"+k1+"', length: "+Y(k);var n1=[];if(f1){n1=P(i,g1,h1,l1);}var o1=O(g1,h1,l1);if(n1.length>0||o1.length>0){m1=m1+", parameters: {";if(n1.length>0){m1=m1+"select: '"+n1.join(',')+"'";}if(o1.length>0){if(n1.length>0){m1=m1+", ";}m1=m1+"expand: '"+o1.join(',')+"'";}m1=m1+"}";}var p1=R(k,j1);if(p1.length>0){m1=m1+", sorter:"+JSON.stringify(p1);}var q1=S(k,i1);if(q1.length>0){m1=m1+", filters:"+JSON.stringify(q1);}m1=m1+"}";return m1;};function O(k,f1,g1){var h1=[];var i1,j1,k1,l1;for(var i=0;i<g1.length;i++){if(!g1[i]){continue;}i1=f1.$path+"/"+g1[i];j1=k.createBindingContext(i1);k1=j1.getObject();k1=k1?k1:[];for(var j=0;j<k1.length;j++){if(k1[j].Value&&k1[j].Value.Path){l1=N(k,f1,k1[j].Value.Path);if(l1&&h1.indexOf(l1)===-1){h1.push(l1);}}}}return h1;}function P(f1,g1,h1,i1){var j1=[];var k1,l1,m1;for(var i=0;i<i1.length;i++){if(!i1[i]){continue;}k1=h1.$path+"/"+i1[i];l1=g1.createBindingContext(k1);var n1={};if(f1&&f1.bDummyContext){jQuery.extend(n1,f1,l1,true);}else{n1=f1;}m1=l1.getObject();if(!m1){m1=[];}else if(jQuery.isPlainObject(m1)){if(m1.Data){m1=m1.Data;}else{m1=[];}}var o1;var p1;var q1;var r1;for(var j=0;j<m1.length;j++){p1=[];o1=m1[j];q1="";r1=o1.RecordType;if(r1==="com.sap.vocabularies.UI.v1.DataField"){q1=z(n1,o1,h1,g1,undefined,undefined,true);}else if(r1==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var s1=n(h1.$path,o1);q1=_(n1,g1.getProperty(s1),h1,g1);}else if(r1==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&o1.Url){var t1;if(!o1.Url.UrlRef){t1=sap.ui.model.odata.AnnotationHelper.format(n1,o1.Url);}if(t1&&t1.substring(0,2)==="{="){q1=t1;}}if(q1){p1=Q(q1);}if(p1&&p1.length>0){var u1;for(var k=0;k<p1.length;k++){u1=p1[k];if(!j1[u1]){j1[u1]=true;var v1=b1(u1,h1);if(v1&&v1!==u1){j1[v1]=true;}var w1=d1(g1,h1,u1);if(w1&&w1!==u1){j1[w1]=true;}}}}}}return Object.keys(j1);}function Q(i){var j=/\${([a-zA-Z0-9\_|\/]*)/g;var k=/[^[{]*[a-zA-Z0-9\_]/g;var f1=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var g1,h1,i1=[];if(i.indexOf("{parts:[")!==-1){i=i.replace("{parts:[","");}if(i.substring(0,2)==="{="){g1=j;h1=1;}else if(i.indexOf("path")!==-1){var j1=k.exec(i);while(j1){if(j1[0].indexOf("path")===-1){i1.push(j1[0]);}j1=k.exec(i);}g1=f1;h1=1;}else{g1=k;h1=0;}var k1=g1.exec(i);while(k1){if(k1[h1]){i1.push(k1[h1]);}k1=g1.exec(i);}return i1;}function R(j,k){var f1=[];var g1,h1;var i1=j.getProperty("/sortBy");if(i1){var j1=j.getProperty('/sortOrder');if(j1&&j1.toLowerCase()!=='descending'){h1=false;}else{h1=true;}g1={path:i1,descending:h1};f1.push(g1);}var k1=k&&k.SortOrder||undefined;var l1,i1;if(k1){for(var i=0;i<k1.length;i++){l1=k1[i];i1=l1.Property.PropertyPath;h1=T(l1.Descending,true);g1={path:i1,descending:h1};f1.push(g1);}}return f1;}sap.ovp.cards.AnnotationHelper.getCardFilters=function(i){var j=i.getProperty('/entityType');var k=j[i.getProperty('/selectionAnnotationPath')];return S(i,k);};function S(k,f1){var g1=[];var h1=k.getProperty("/filters");if(h1){g1=g1.concat(h1);}var i1=f1&&f1.SelectOptions;var j1,k1,l1;if(i1){for(var i=0;i<i1.length;i++){j1=i1[i];k1=j1.PropertyName.PropertyPath;for(var j=0;j<j1.Ranges.length;j++){l1=j1.Ranges[j];if(l1.Sign.EnumMember){var m1={path:k1,operator:l1.Option.EnumMember.split("/")[1],value1:V(l1.Low),value2:V(l1.High),sign:l1.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};g1.push(m1);}}}}return g1;}function T(i,j){if(i&&i.Boolean){if(i.Boolean.toLowerCase()==="true"){return true;}else if(i.Boolean.toLowerCase()==="false"){return false;}}else if(i&&i.Bool){if(i.Bool.toLowerCase()==="true"){return true;}else if(i.Bool.toLowerCase()==="false"){return false;}}return j;}function U(i){var j;if(i){if(i.String){j=Number(i.String);}else if(i.Int){j=Number(i.Int);}else if(i.Decimal){j=Number(i.Decimal);}else if(i.Double){j=Number(i.Double);}else if(i.Single){j=Number(i.Single);}}return j;}function V(i){var j;if(i){if(i.String||i.String===""){j=i.String;}else if(i.Boolean||i.Bool){j=T(i);}else{j=U(i);}}return j;}function W(i){if(i){if(i.Path){return"{path:'"+i.Path+"'}";}else{return V(i);}}else{return"";}}var X={"List_condensed":{phone:5,tablet:5,desktop:5},"List_extended":{phone:3,tablet:3,desktop:3},"List_condensed_bar":{phone:5,tablet:5,desktop:5},"List_extended_bar":{phone:3,tablet:3,desktop:3},"Table":{phone:5,tablet:5,desktop:5},"Stack_simple":{phone:20,tablet:20,desktop:20},"Stack_complex":{phone:5,tablet:5,desktop:5}};function Y(i){var j=i.getProperty('/contentFragment');var k=i.getProperty('/listType');var f1=i.getProperty('/listFlavor');var g1;var h1="desktop";if(sap.ui.Device.system.phone){h1="phone";}else if(sap.ui.Device.system.tablet){h1="tablet";}if(j=="sap.ovp.cards.list.List"){if(k=="extended"){if(f1=="bar"){g1=X["List_extended_bar"];}else{g1=X["List_extended"];}}else if(f1=="bar"){g1=X["List_condensed_bar"];}else{g1=X["List_condensed"];}}else if(j=="sap.ovp.cards.table.Table"){g1=X["Table"];}else if(j=="sap.ovp.cards.stack.Stack"){if(i.getProperty('/objectStreamCardsNavigationProperty')){g1=X["Stack_complex"];}else{g1=X["Stack_simple"];}}if(g1){return g1[h1];}return 5;}sap.ovp.cards.AnnotationHelper.removeDuplicateDataField=function(i){var j=i.getObject();var k=l(i,j);var f1=k.map(function(g1){return g1.Value.Path;});j.filter(function(g1,h1){if(g1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&f1.indexOf(g1.Value.Path)>-1){j.splice(h1,1);}});};sap.ovp.cards.AnnotationHelper.formatUrl=function(i,j){if(j.charAt(0)==='/'||j.indexOf("http")===0){return j;}var k=i.getModel().getProperty("/baseUrl");if(k){return k+"/"+j;}return j;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(i,j){var k=l(i,j);return k.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(i,j,k){var f1=l(i,j),g1=f1[k];if(g1&&g1.Value&&g1.Value.Path){return g1.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(i,j){return t(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(i,j){return t(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(i,j){return t(i,j,2);};sap.ovp.cards.AnnotationHelper.getFourthDataFieldName=function(i,j){return t(i,j,3);};sap.ovp.cards.AnnotationHelper.getFifthDataFieldName=function(i,j){return t(i,j,4);};sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue=function(i,j){return r(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue=function(i,j){return r(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue=function(i,j){return r(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue=function(i,j){return r(i,j,3);};sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue=function(i,j){return r(i,j,4);};sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue=function(i,j){return r(i,j,5);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(i,j){return u(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(i,j){return u(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(i,j){return u(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue=function(i,j){return v(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue=function(i,j){return v(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue=function(i,j){return v(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(i,j){return H(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(i,j){return H(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(i,j){return H(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField=function(i,j){return J(i,j,0);};sap.ovp.cards.AnnotationHelper.formatKPIHeaderState=function(i,j){return K(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality=function(i,j){return w(i,j,0);};sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality=function(i,j){return w(i,j,1);};sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality=function(i,j){return w(i,j,2);};function Z(i,j){var k=i.getPath();var f1=k.slice(0,k.lastIndexOf("/"));f1=f1.slice(0,f1.lastIndexOf("/"));var g1=n(f1,j);j=i.getModel().getProperty(g1);return j;}sap.ovp.cards.AnnotationHelper.formatDataPointValue=function(i,j){if(!j){return"";}var k=i.getSetting('ovpCardProperties');var f1=k.getProperty("/entityType");var g1=k.getProperty("/metaModel");var h1=jQuery.extend({},j);var i1=jQuery.extend({},i);j=Z(i1,h1);return _(i,j,f1,g1);};sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric=function(i,j){var k=jQuery.extend({},j);var f1=jQuery.extend({},i);var g1="None";j=Z(f1,k);if(j&&j.Criticality){g1=I(i,j);}else{g1=K(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);g1=b(g1);}return g1;};sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric=function(i,j){var k=jQuery.extend({},j);var f1=jQuery.extend({},i);j=Z(f1,k);if(j&&j.Criticality){return true;}};sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric=function(i,j){var k=jQuery.extend({},j);var f1=jQuery.extend({},i);j=Z(f1,k);var g1="None";if(j&&j.Criticality&&j.Criticality.Path){g1="{path:'"+j.Criticality.Path+"'}";}else{g1=K(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);g1=b(g1);}return g1;};sap.ovp.cards.AnnotationHelper.hasActions=function(j,k){var f1;for(var i=0;i<k.length;i++){f1=k[i];if(f1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||f1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||f1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1;}}return 0;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(i,j){var k=l(i,j)[0];if(k&&k.Value&&k.Value.Path){var f1=i.getPath().substr(0,i.getPath().lastIndexOf("/")+1);var g1=i.getModel();var h1=g1.getProperty(f1);var i1=g1.getODataProperty(h1,k.Value.Path);if(i1&&i1["Org.OData.Measures.V1.Unit"]){return i1["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(i){var j=i.getObject();var k=i.getModel();var f1=k.getProperty("/metaModel");var g1=f1.getODataEntitySet(k.getProperty("/entitySet"));var h1=f1.getODataEntityType(g1.entityType);j=h1.$path+"/"+j;return f1.createBindingContext(j);};sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet=function(i,j,k){jQuery.sap.require("sap.ui.model.analytics.odata4analytics");var f1="";var g1=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(i));var h1=g1.findQueryResultByName(j.name);if(!h1){f1="/"+j.name;jQuery.sap.log.error("findQueryResultByName","Entity Set not found in the QueryResultRequest");return f1;}var i1=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(h1);var j1=h1.getParameterization();if(j1){i1.setParameterizationRequest(new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(j1));jQuery.each(k.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){i1.getParameterizationRequest().setParameterValue(this.PropertyName.PropertyPath,this.PropertyValueFrom.String,this.PropertyValueTo.String);}else{i1.getParameterizationRequest().setParameterValue(this.PropertyName.PropertyPath,this.PropertyValue.String);}});}try{f1=i1.getURIToQueryResultEntitySet();}catch(k1){h1=i1.getQueryResult();f1="/"+h1.getEntitySet().getQName();jQuery.sap.log.error("getEntitySetPathWithParameters","binding path with parameters failed - "+k1||k1.message);}return f1;};sap.ovp.cards.AnnotationHelper.getAssociationObject=function(j,k,ns){var f1=j.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<f1.length;i++){if(ns+"."+f1[i].name===k){return f1[i];}}};sap.ovp.cards.AnnotationHelper.getAggregateNumber=function(i,j,k,f1){var g1=k.Value.Path;var h1="";var i1=f1&&f1.Parameters;var j1="";if(i1){var k1=i.getSetting("dataModel");var l1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(k1,j,f1);h1+="{path: '"+l1+"'";}else{h1+="{path: '/"+j.name+"'";}h1+=", length: 1";var m1=i.getSetting('ovpCardProperties');var n1=m1.getProperty("/entityType");var o1=b1(g1,n1);var p1=S(m1,f1);if(p1.length>0){j1+=", filters: "+JSON.stringify(p1);}var q1=[];q1.push(g1);if(o1){q1.push(o1);}if(k.TrendCalculation&&k.TrendCalculation.ReferenceValue&&k.TrendCalculation.ReferenceValue.Path){q1.push(k.TrendCalculation.ReferenceValue.Path);}return h1+", parameters:{select:'"+q1.join(",")+"'}"+j1+"}";};sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber=function(i,j){if(!j||!j.Value||!j.Value.Path){return"";}return y(i,j,true,false);};sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon=function(i,j){if(!j||!j.Value||!j.Value.Path||!j.TrendCalculation){return"";}var k=W(j.Value);var f1=W(j.TrendCalculation.ReferenceValue);var g1=W(j.TrendCalculation.DownDifference);var h1=W(j.TrendCalculation.UpDifference);var i1=M(f1);var j1=M(g1);var k1=M(h1);var l1="parts: ["+k;l1+=i1?","+f1:"";l1+=j1?","+g1:"";l1+=k1?","+h1:"";l1+="]";var m1=function(){var o1=1;return f(arguments[0],i1?arguments[o1++]:f1,j1?arguments[o1++]:g1,k1?arguments[o1++]:h1);};var n1=a(m1,"formatTrendDirection");return"{"+l1+", formatter: '"+n1+"'}";};sap.ovp.cards.AnnotationHelper.formThePathForUOM=function(i,j){if(!j||!j.Value||!j.Value.Path){return"";}return y(i,j,false,true);};sap.ovp.cards.AnnotationHelper.formPathForPercentageChange=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(i.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+i.Value.Path+"'}, {path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}else{return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}};sap.ovp.cards.AnnotationHelper.formPathForTargetValue=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(i.TrendCalculation.ReferenceValue){if(i.TrendCalculation.ReferenceValue.String){return Number(i.TrendCalculation.ReferenceValue.String);}if(i.TrendCalculation.ReferenceValue.Path){return("{path:'"+i.TrendCalculation.ReferenceValue.Path+"'}");}}};sap.ovp.cards.AnnotationHelper.returnPercentageChange=function(i,j){jQuery.sap.require("sap.ui.core.format.NumberFormat");var k="";i=Number(i);var f1=this.getModel("ovpCardProperties");if(!f1){return k;}var g1=f1.getProperty("/dataPointAnnotationPath");var h1=f1.getProperty("/entityType")[g1];var i1;if(!h1.TrendCalculation){return k;}if(h1.TrendCalculation.ReferenceValue){if(h1.TrendCalculation.ReferenceValue.String){i1=Number(h1.TrendCalculation.ReferenceValue.String);}if(h1.TrendCalculation.ReferenceValue.Path){i1=Number(j);}if(!i1||i1==0){return k;}var j1=((Number(i)-i1)/i1);var k1=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});return k1.format(j1);}};sap.ovp.cards.AnnotationHelper.isPresentationVarientPresent=function(i){if(i&&i.GroupBy&&!(jQuery.isEmptyObject(i.GroupBy))&&i.GroupBy[0].hasOwnProperty('PropertyPath')){return true;}else{return false;}};sap.ovp.cards.AnnotationHelper.listGroupBy=function(i){var j="";var k=i&&i.GroupBy;if(!k){return j;}var f1=this.getModel('ovpCardProperties').getProperty("/metaModel");var g1=this.getModel('ovpCardProperties').getProperty("/entityType");var h1;if(i.GroupBy.constructor===Array){h1=i.GroupBy;}else if(!i.GroupBy.Collection){return j;}else{h1=i.GroupBy.Collection;}var i1;jQuery.each(h1,function(){i1=c1(f1,g1,this.PropertyPath);if(!i1){return;}j+=i1;j+=", ";});if(j[j.length-1]===" "&&j[j.length-2]===","){j=j.substring(0,j.length-2);}return j==""?"":sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("By",[j]);};sap.ovp.cards.AnnotationHelper.formTheFilterByString=function(k,f1){var g1=k.getSetting('ovpCardProperties');var h1=g1.getProperty("/entityType");var i1=g1.getProperty("/metaModel");var j1=S(g1,f1);if(j1.length==0){return"";}var k1;var l1;for(var i=0;i<j1.length;i++){k1=j1[i].path;l1=d1(i1,h1,k1);if(l1!==k1){for(var j=0;j<j1.length;j++){if((j1[j].path==l1)){j1.splice(i,1);break;}}}}return $(j1);};function $(j){var k=[];for(var i=0;i<j.length;i++){k.push(a1(j[i]));}return k.join(', ');}function a1(i){var j=false;var k=i.value1;if(i.operator[0]==="N"){j=true;}if(i.value2){k+=" - "+i.value2;}if(j){k=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("kpiHeader_Filter_NotOperator",[k]);}return k;}function b1(j,k){var f1=k.property;for(var i=0,g1=f1.length;i<g1;i++){if(f1[i].name==j){if(f1[i].hasOwnProperty("sap:unit")){return f1[i]["sap:unit"];}break;}}return null;}function c1(i,j,k){return e1(i,j,k,"com.sap.vocabularies.Common.v1.Label");}function d1(i,j,k){return e1(i,j,k,"sap:text");}function e1(i,j,k,f1){var g1=i.getODataProperty(j,k);if(!g1){jQuery.sap.log.error("No Property Found for with Name '"+k+" For Entity-Type '"+j.name+"'");return;}var h1=g1[f1];if(h1){if(f1==="com.sap.vocabularies.Common.v1.Label"){return h1.String;}return h1;}return g1.name;}sap.ovp.cards.AnnotationHelper._criticality2state=c;sap.ovp.cards.AnnotationHelper._calculateCriticalityState=d;sap.ovp.cards.AnnotationHelper._calculateTrendDirection=f;sap.ovp.cards.AnnotationHelper._getPropertiesFromBindingString=Q;sap.ovp.cards.AnnotationHelper.sortCollectionByImportance=p;sap.ovp.cards.AnnotationHelper.formatField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForUOM.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByString.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFourthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFifthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatKPIHeaderState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.removeDuplicateDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric.requiresIContext=true;}());
