(function(){"use strict";jQuery.sap.require("sap.ui.model.odata.ODataUtils");jQuery.sap.require("sap.ovp.cards.generic.Component");jQuery.sap.require("sap.ui.generic.app.navigation.service.NavigationHandler");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ui.controller("sap.ovp.app.Main",{onInit:function(){this.oCardsModels={};this.oLoadedComponents={};jQuery.sap.measure.start("ovp:GlobalFilter","Main Controller init -> Global Filter loaded","ovp");jQuery.sap.measure.start("ovp:Personalization","Main Controller init -> Personalization loaded","ovp");this.isInitialLoading=true;if(this.getOwnerComponent()){this.oValueHelpMap=this.getOwnerComponent().getModel("ui").getProperty("/ValueHelpEntityMap");}this._initSmartVariantManagement();this.getLayout().addStyleClass("ovpLayoutElement");this.oState={};this.oState.oSmartFilterbar=this.byId("ovpGlobalFilter");this._initGlobalFilter();},recreateCard:function(c){var C=this._getCardFromManifest(c.cardId);if(C.template=="sap.ovp.cards.charts.analytical"){C.settings.chartAnnotationPath=c.chartAnnotationPath;C.settings.navigation=c.navigation;}C.settings.annotationPath=c.annotationPath;C.settings.presentationAnnotationPath=c.presentationAnnotationPath;C.settings.selectionAnnotationPath=c.selectionAnnotationPath;C.settings.dataPointAnnotationPath=c.dataPointAnnotationPath;C.settings.identificationAnnotationPath=c.identificationAnnotationPath;C.settings.selectedKey=c.selectedKey;if(C){this.createLoadingCard(C);C.settings.baseUrl=this._getBaseUrl();this._initCardModel(C.model);this._loadCardComponent(C.template);this.createCard(C);}if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){var d=this.getLayout().getDashboardLayoutUtil();if(d){var D=d.getDashboardLayoutModel();var o=D.getCardById(C.id);var r={colSpan:o.dashboardLayout.colSpan,rowSpan:o.dashboardLayout.rowSpan};d.setRecreateCard(r);o.dashboardLayout.autoSpan=true;}}this.saveVariant();},onBeforeRendering:function(){},onAfterRendering:function(){if(this.initialized){return;}this.initialized=true;this.oPersistencyVariantPromise.then(function(v){jQuery.sap.measure.end("ovp:Personalization");this.persistencyVariantLoaded=true;var c;var a=[],b=[];this.aManifestOrderedCards=this._getCardArrayAsVariantFormat(this.getLayout().getContent());if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){this.aOrderedCards=this._mergeLrepDashboardLayout(this.aManifestOrderedCards,v);}else{this.aOrderedCards=this._mergeCards(this.aManifestOrderedCards,v);}for(var d=0;d<this.aOrderedCards.length;d++){c=this._getCardFromManifest(this.aOrderedCards[d].id);if(c&&c.settings&&c.settings.requireAppAuthorization){a.push({id:c.id,cardIntent:c.settings.requireAppAuthorization});b.push(c.settings.requireAppAuthorization);}}if(b.length>0){this._checkForAuthorization(a,b);}this._updateLayoutWithOrderedCards();if(this.isDragAndDropEnabled()){this._initShowHideCardsButton();}jQuery.sap.measure.start("ovp:CreateLoadingCards","Create Loading cards","ovp");for(var i=0;i<this.aOrderedCards.length;i++){if(this.aOrderedCards[i].visibility){c=this._getCardFromManifest(this.aOrderedCards[i].id);if(c){this.createLoadingCard(c);}}}jQuery.sap.measure.end("ovp:CreateLoadingCards");setTimeout(function(){this.getLayout().addStyleClass("ovpLayoutElementShow");}.bind(this),0);setTimeout(function(){jQuery.sap.measure.start("ovp:CreateCards","Create cards loop","ovp");for(var i=0;i<this.aOrderedCards.length;i++){if(this.aOrderedCards[i].visibility){c=this._getCardFromManifest(this.aOrderedCards[i].id);if(!c.settings.title){jQuery.sap.log.error("title is mandatory for card ID : "+c.id);}if(c.settings.tabs){var I=0;if(this.aOrderedCards[i].selectedKey){I=this.aOrderedCards[i].selectedKey-1;}this.initializeTabbedCard(c,I);}if(c){c.settings.baseUrl=this._getBaseUrl();this._initCardModel(c.model);this._loadCardComponent(c.template);this.createCard(c);}}}jQuery.sap.measure.end("ovp:CreateCards");}.bind(this),10);if(this.busyDialog){this.busyDialog.close();}}.bind(this),function(e){jQuery.sap.log.error("Could not load information from LREP Persistency");jQuery.sap.log.error(e);});if(sap.ui.Device.system.phone){jQuery.sap.require("sap.ovp.ui.SmartphoneHeaderToggle");sap.ovp.ui.SmartphoneHeaderToggle.enable(this);}setTimeout(function(){if(!this.persistencyVariantLoaded){this.busyDialog=new sap.m.BusyDialog({text:this._getLibraryResourceBundle().getText("loading_dialog_text")});this.busyDialog.open();this.busyDialog.addStyleClass('sapOVPBusyDialog');}}.bind(this),500);},initializeTabbedCard:function(c,i){if(c.template=="sap.ovp.cards.charts.analytical"){c.settings.chartAnnotationPath=c.settings.tabs[i].chartAnnotationPath;c.settings.navigation=c.settings.tabs[i].navigation;}c.settings.annotationPath=c.settings.tabs[i].annotationPath;c.settings.presentationAnnotationPath=c.settings.tabs[i].presentationAnnotationPath;c.settings.selectionAnnotationPath=c.settings.tabs[i].selectionAnnotationPath;c.settings.dataPointAnnotationPath=c.settings.tabs[i].dataPointAnnotationPath;c.settings.identificationAnnotationPath=c.settings.tabs[i].identificationAnnotationPath;c.settings.selectedKey=i+1;},_getLibraryResourceBundle:function(){if(!this.oLibraryResourceBundle){this.oLibraryResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");}return this.oLibraryResourceBundle;},_getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new sap.ui.model.resource.ResourceModel({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},_getCardsModel:function(){var u=this.getView().getModel("ui");if(!this.oCards){this.oCards=u.getProperty("/cards");}return this.oCards;},_getBaseUrl:function(){var u=this.getView().getModel("ui");if(!this.sBaseUrl){this.sBaseUrl=u.getProperty("/baseUrl");}return this.sBaseUrl;},_getCardFromManifest:function(c){var C=this._getCardsModel();for(var i=0;i<C.length;i++){if(C[i].id===c){return C[i];}}return null;},_getCardArrayAsVariantFormat:function(c){var C=[];for(var i=0;i<c.length;i++){var I=this._getCardId(c[i].getId());C.push({id:I,visibility:c[i].getVisible()});var s;if(this.getView()&&this.getView().byId){if(this.getView().byId(I).getComponentInstance()){s=this.getView().byId(I).getComponentInstance().getComponentData().settings.selectedKey;}}if(s){C[C.length-1].selectedKey=s;}}return C;},_mergeCards:function(l,v){var a=(v&&v.cards)?v.cards:[];var r=[];var c;var C;var s;var L=(l&&l.length)?l:[];for(var i=0;i<a.length;i++){C=a[i].visibility;s=a[i].selectedKey;for(var j=0;j<L.length;j++){c=L[j].id;if(a[i].id===c){r.push({id:c,visibility:C});if(s){r[r.length-1].selectedKey=s;}break;}}}for(var j=0;j<L.length;j++){var b=false;c=L[j].id;C=L[j].visibility;s=L[j].selectedKey;for(var i=0;!b&&i<r.length;i++){if(r[i].id===c){b=true;}}if(!b){r.push({id:c,visibility:C});if(s){r[r.length-1].selectedKey=s;}}}return r;},_checkForAuthorization:function(c,a){var t=this;var n=sap.ovp.cards.CommonUtils.getNavigationHandler();if(n&&n.oCrossAppNavService){n.oCrossAppNavService.isIntentSupported(a).done(function(r){for(var i=0;i<c.length;i++){if(r[c[i].cardIntent].supported===false){for(var j=0;j<t.aOrderedCards.length;j++){if(c[i].id===t.aOrderedCards[j].id){t.aOrderedCards.splice(j,1);break;}}}}}).fail(function(){jQuery.sap.log.error("Could not get authorization from isIntentSupported");});}},_mergeLrepDashboardLayout:function(l,L){var c=[];var u=this.getLayout().getModel("ui");var o={};var a=null;var b=u.getProperty("/dashboardLayout");if(b){var v={};for(a in b){if(b.hasOwnProperty(a)&&b[a]){v=b[a];v.id=a;v.__ovpDBLVarSource="manifest";v.__ovpDBLVarId="C"+parseInt(v.id.replace(/[^0-9\.]/g,""),10);o[v.__ovpDBLVarId]=v;}}}this.getLayout().getDashboardLayoutModel().setManifestLayoutsJSON(JSON.stringify(o));this._bDashboardLayoutLrepActive=true;if(L&&L.dashboardLayout){for(a in L.dashboardLayout){if(L.dashboardLayout[a]){L.dashboardLayout[a].__ovpDBLVarSource="lrep";o[a]=L.dashboardLayout[a];}}}this.getLayout().getDashboardLayoutModel().setLayoutVars(o);u.setProperty("/initialDashboardLayout",[this.getLayout().getDashboardLayoutUtil().buildLayout(jQuery(window).width())]);if(a){var m=u.getProperty("/cards");var d=o[a];if(m&&d){c=this._initDashboardLayoutCardVisibility(m,d,l);}}if(c.length===0){c=this._mergeCards(this.aManifestOrderedCards,v);}return c;},_initDashboardLayoutCardVisibility:function(m,l,L){var c=[];var i=0;var C;var o=null;var v=true;if(l&&m){for(i=0;i<m.length;i++){C=m[i].id;o=l[C];if(o&&o.hasOwnProperty("visible")){v=o.visible;}else{v=true;}c.push({id:C,visibility:v});}if(L&&L.length>0){for(i=0;i<L.length;i++){C=L[i].id;if(!l[C]){c.push({id:C,visibility:L[i].visibility});}}}}return c;},_updateLayoutWithOrderedCards:function(){var l=this.getLayout();var o=this.aOrderedCards;l.removeAllContent();for(var i=0;i<o.length;i++){var c=this.getView().byId(o[i].id);c.setVisible(o[i].visibility);l.addContent(c);}},_updateDashboardLayoutCards:function(c){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(this.getLayout().getDashboardLayoutUtil()){this.getLayout().getDashboardLayoutUtil().updateCardVisibility(c);}}},_resetDashboardLayout:function(){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(this.getLayout().getDashboardLayoutUtil()){this.getLayout().getDashboardLayoutUtil().resetToManifest();}this.getLayout().rerender();}},verifyGlobalFilterLoaded:function(){if(this.getGlobalFilter()._validateMandatoryFields()){if(this.getGlobalFilter().search()){return true;}}return false;},onGlobalFilterChange:function(){this.filterChanged=true;},onGlobalFilterSearch:function(){if(this.filterChanged){var b="ovp-"+new Date().getTime();for(var m in this.oCardsModels){if(this.oCardsModels.hasOwnProperty(m)){this.oCardsModels[m].refresh(false,false,b);}}this.filterChanged=false;}},_initGlobalFilter:function(){var g=this.getGlobalFilter();if(!g){this._parseNavigationVariant();jQuery.sap.measure.end("ovp:GlobalFilter");return;}this.oGlobalFilterLodedPromise=new Promise(function(r,a){g.attachAfterVariantLoad(function(){this.oParseNavigationPromise.done(function(A,u,n){this._setNavigationVariantToGlobalFilter(A,u,n);}.bind(this));this.oParseNavigationPromise.fail(function(){jQuery.sap.log.error("Could not parse navigation variant from URL");});this.oParseNavigationPromise.always(function(){if(g&&this.verifyGlobalFilterLoaded()){r();}}.bind(this));},this);g.attachInitialise(function(){this._parseNavigationVariant();if(!g.getCurrentVariantId()){if(this.oParseNavigationPromise){this.oParseNavigationPromise.done(function(A,u,n){if(A){this._setNavigationVariantToGlobalFilter(A,u,n);}}.bind(this));this.oParseNavigationPromise.fail(function(){jQuery.sap.log.error("Could not parse navigation variant from URL");});this.oParseNavigationPromise.always(function(){if(g&&this.verifyGlobalFilterLoaded()){r();}}.bind(this));}else{if(g&&this.verifyGlobalFilterLoaded()){r();}}}},this);g.attachSearch(function(){r();this.onGlobalFilterSearch();},this);g.attachFilterChange(this.onGlobalFilterChange,this);}.bind(this));this.oGlobalFilterLodedPromise.then(function(v){jQuery.sap.measure.end("ovp:GlobalFilter");});},_loadCardComponent:function(c){if(!this.oLoadedComponents[c]){jQuery.sap.measure.start("ovp:CardComponentLoad:"+c,"Card Component load","ovp");this.oLoadedComponents[c]=sap.ui.component.load({name:c,url:jQuery.sap.getModulePath(c),async:true});this.oLoadedComponents[c].then(function(){jQuery.sap.measure.end("ovp:CardComponentLoad:"+c);});}},_initCardModel:function(c){if(this.oCardsModels[c]||!c){return;}this.oCardsModels[c]=this.getView().getModel(c);if(!this.oCardsModels[c].bUseBatch){this.oCardsModels[c].setUseBatch(false);}else{this.oCardsModels[c].setUseBatch(true);}if(this.getGlobalFilter()){this._overrideCardModelRead(this.oCardsModels[c]);}},toggleFilterBar:function toggleFilterBar(){var g=this.getGlobalFilter();function t(j,b,h){b.height(h);j.css('top',0);}function a(j,b,h){b.height(0);j.css("top","-"+h+"px");}var i=g.getVisible();if((sap.ui.Device.system.phone)||(sap.ui.Device.system.tablet)){g.setVisible(!i);return;}if(toggleFilterBar.animationInProcess){return;}toggleFilterBar.animationInProcess=true;if(i){var j=jQuery(g.getDomRef());var b=jQuery(this.getView().byId("ovpGlobalFilterWrapper").getDomRef());var h=b.height();t(j,b,h);b.height();b.one('transitionend',function(e){g.setVisible(false);toggleFilterBar.animationInProcess=false;});a(j,b,h);}else{g.setVisible(true);setTimeout(function(){var j=jQuery(g.getDomRef());var b=jQuery(this.getView().byId("ovpGlobalFilterWrapper").getDomRef());var h=j.outerHeight();a(j,b,h);b.height();b.one('transitionend',function(e){b.css("height","auto");toggleFilterBar.animationInProcess=false;});t(j,b,h);}.bind(this));}},_overrideCardModelRead:function(m){var o=m.read;var t=this;m.read=function(){var f=t.getGlobalFilter().getFilters();var p=arguments[1];if(!p){p={};Array.prototype.push.call(arguments,p);}var e=t._getEntityTypeFromPath(m,arguments[0],p.context);var v=false;if(t.oValueHelpMap){if(t.oValueHelpMap.indexOf(e.entityType)!=-1){v=true;}}if(e&&!v){var r=t._getEntityRelevantFilters(e,f);if(r.length>0){var a=-1;var u=p.urlParameters;if(u){for(var i=0;i<u.length;i++){if((u[i]).lastIndexOf("$filter=",0)===0){a=i;break;}}}if(a>=0){u[a]=u[a]+"%20and%20"+sap.ui.model.odata.ODataUtils.createFilterParams(r,m.oMetadata,e).substr(8);}else{p.filters=r;}}}o.apply(m,arguments);};},_getEntityTypeFromPath:function(m,p,c){var n=sap.ui.model.odata.v2.ODataModel.prototype._normalizePath.apply(m,[p,c]);var e=sap.ui.model.odata.ODataMetadata.prototype._getEntityTypeByPath.apply(m.oMetadata,[n]);return e;},_getEntityRelevantFilters:function(e,f){var r=[];if(f.length){var a=f[0].aFilters;var b=e.property;for(var i=0;i<a.length;i++){var c;if(a[i].aFilters){c=a[i].aFilters[0].sPath;}else{c=a[i].sPath;}for(var j=0;j<b.length;j++){if(b[j].name===c){r.push(a[i]);break;}}}}if(r.length!=0){var R=[];R.push(new sap.ui.model.Filter(r,f[0].bAnd));return R;}return r;},_checkIsCardValid:function(c){var C=c+".Component";var o,a;jQuery.sap.require(C);var b=jQuery.sap.getObject(C);if(!b){return false;}if((b!==sap.ovp.cards.generic.Component)&&!(b.prototype instanceof sap.ovp.cards.generic.Component)){return false;}if((o=b.getMetadata())&&(a=o.getCustomizing())){if(a["sap.ui.viewReplacements"]&&a["sap.ui.viewReplacements"]["sap.ovp.cards.generic.Card"]){return false;}}if(b.prototype.createContent!=sap.ovp.cards.generic.Component.prototype.createContent){return false;}if(b.prototype.getPreprocessors!=sap.ovp.cards.generic.Component.prototype.getPreprocessors){return false;}return true;},_createCardComponent:function(v,m,c){var i="ovp:CreateCard-"+c.template+":"+c.id;jQuery.sap.measure.start(i,"Create Card","ovp");var o=v.getModel("@i18n");if(c.template&&this._checkIsCardValid(c.template)){var C={name:c.template,componentData:{model:m,i18n:o,cardId:c.id,settings:c.settings,appComponent:this.getOwnerComponent(),mainComponent:this}};var g=this.getGlobalFilter();if(g){C.componentData.globalFilter={getFilterDataAsString:g.getDataSuiteFormat.bind(g)};}var a=sap.ui.component(C);var b=v.byId(c.id);var O=b.getComponentInstance();b.setComponent(a);if(O){setTimeout(function(){O.destroy();},0);}}else{jQuery.sap.log.error("Could not create Card from '"+c.template+"' template. Card is not valid.");}jQuery.sap.measure.end(i);},createLoadingCard:function(c){var l=jQuery.extend(true,{},c,{template:"sap.ovp.cards.loading"});this._createCardComponent(this.getView(),undefined,l);},createCard:function(c){var v=this.getView();var m=v.getModel(c.model);Promise.all([m.getMetaModel().loaded(),this.oGlobalFilterLodedPromise,this.oLoadedComponents[c.template]]).then(function(){this._createCardComponent(v,m,c);}.bind(this),function(r){jQuery.sap.log.error("Can't load card with id:'"+c.id+"' and type:'"+c.template+"', reason:"+r);});},_getCardId:function(g){var a=this.getView().getId()+"--";if(g.indexOf(a)!=-1){var s=g.indexOf(a)+a.length;return g.substr(s);}return g;},_initSmartVariantManagement:function(){var p=this._createPersistencyControlForSmartVariantManagement();var o=new sap.ui.comp.smartvariants.PersonalizableInfo({type:"OVPVariant",keyName:"persistencyKey",control:p});this.oPersistencyVariantPromise=new Promise(function(r,a){this.smartVariandManagement=new sap.ui.comp.smartvariants.SmartVariantManagement({personalizableControls:o,initialise:function(e){var k=e.getParameters().variantKeys;if(k.length){r(this.smartVariandManagement.getVariantContent(p,k[0]));}else{r(null);}}.bind(this)});this.smartVariandManagement.initialise();}.bind(this));},layoutChanged:function(){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(this._bDashboardLayoutLrepActive){this.saveVariant();}}else{var c=this.getLayout().getContent();this.aOrderedCards=this._getCardArrayAsVariantFormat(c);this.saveVariant();}},saveVariant:function(e){var t=this;this.smartVariandManagement.getVariantsInfo(function(v){var p=null;if(v&&v.length>0){p=v[0].key;}var o=p!==null;var P={name:"Personalisation",global:false,overwrite:o,key:p,def:true};t.smartVariandManagement.fireSave(P);});},getLayout:function(){return this.getView().byId("ovpLayout");},_createPersistencyControlForSmartVariantManagement:function(){var t=this;sap.ui.core.Control.extend("sap.ovp.app.PersistencyControl",{metadata:{properties:{persistencyKey:{type:"string",group:"Misc",defaultValue:null}}}});var p=new sap.ovp.app.PersistencyControl({persistencyKey:"ovpVariant"});p.fetchVariant=function(){if(t.isInitialLoading){t.isInitialLoading=false;return{};}var l=this.getLayout();if(!l){jQuery.sap.log.error("Could not save persistency variant - 'ovpLayout' does not exists");return;}if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){var v=this.getLayout().getLayoutDataJSON();return{dashboardLayout:v};}else{var L=l.getContent();var c=this._getCardArrayAsVariantFormat(L);this.oOrderedCards=c;return{cards:c};}}.bind(this);return p;},_initShowHideCardsButton:function(){var s,c;var s=sap.ushell.services.AppConfiguration;var c=new sap.m.Button().addStyleClass("ovpManageCardsBtn");c.setIcon('sap-icon://dimension');c.setTooltip(this._getLibraryResourceBundle().getText("hideCardsBtn_tooltip"));c.setText(this._getLibraryResourceBundle().getText("hideCardsBtn_title"));c.attachPress((this._onCardMenuButtonPress).bind(this));s.addApplicationSettingsButtons([c]);},_onCardMenuButtonPress:function(){var m;function g(e,f){for(var i=0;i<e.length;i++){if(e[i].id==f){return i;}}return-1;}function c(e,n){var f=-1;for(var i=0;i<n.length;i++){if(e[i].id==n[i].id){f=i;}else{f=g(e,n[i].id);}if(n[i].visibility!=e[f].visibility){if(n[i].visibility===true){var h=this._getCardFromManifest(n[i].id);if(h){this.createLoadingCard(h);h.settings.baseUrl=this._getBaseUrl();this._initCardModel(h.model);this._loadCardComponent(h.template);this.createCard(h);}}else{var j=this.getView().byId(n[i].id);var k=j.getComponentInstance();if(k){k.destroy();}}}}}function a(i){var e=this._getCardFromManifest(i);var f=e.settings;if(f.title){return f.title;}else if(f.category){return(f.category);}else if(f.subTitle){return f.subTitle;}return i;}var C=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:{path:"id",formatter:a.bind(this)}}),new sap.m.Switch({state:"{visibility}",customTextOff:" ",customTextOn:" ",change:function(e){var p=e.oSource.getParent();p.toggleStyleClass('sapOVPHideCardsTableItem');p.getCells()[0].toggleStyleClass('sapOVPHideCardsDisabledCell');},tooltip:this._getLibraryResourceBundle().getText("hideCards_switchTooltip")})]});var o=new sap.m.Table("sapOVPHideCardsTable",{backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.Inner,columns:[new sap.m.Column({vAlign:"Middle"}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Right,vAlign:"Middle",width:"4.94rem"})]});o.addStyleClass('sapOVPHideCardsTable');o.bindItems({path:"/cards",template:C});var O=o.onAfterRendering;o.onAfterRendering=function(e){O.apply(o,arguments);var f=e.srcControl.mAggregations.items;if(f){for(var i=0;i<f.length;i++){if(!f[i].getCells()[1].getState()){f[i].addStyleClass('sapOVPHideCardsTableItem');f[i].getCells()[0].addStyleClass('sapOVPHideCardsDisabledCell');}}}setTimeout(function(){jQuery('.sapMListTblRow').first().focus();},200);};var s=new sap.m.Button("manageCardsokBtn",{text:this._getLibraryResourceBundle().getText("okBtn"),press:function(){var D=this.oDialog.getModel().getProperty('/cards');c.apply(this,[this.aOrderedCards,D]);this.aOrderedCards=D;this._updateDashboardLayoutCards(this.aOrderedCards);this._updateLayoutWithOrderedCards();this.saveVariant();this.oDialog.close();}.bind(this)});var b=new sap.m.Button("manageCardsCancelBtn",{text:this._getLibraryResourceBundle().getText("cancelBtn"),press:function(){this.oDialog.close();}.bind(this)});var r=new sap.m.Button("manageCardsResetBtn",{text:this._getLibraryResourceBundle().getText("resetBtn"),press:function(){sap.m.MessageBox.show(this._getLibraryResourceBundle().getText("reset_cards_confirmation_msg"),{id:"resetCardsConfirmation",icon:sap.m.MessageBox.Icon.QUESTION,title:this._getLibraryResourceBundle().getText("reset_cards_confirmation_title"),actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(A){if(A===sap.m.MessageBox.Action.OK){this.smartVariandManagement.getVariantsInfo(function(v){var p=null;if(v&&v.length>0){p=v[0].key;this.smartVariandManagement.fireManage({deleted:[p]});}c.apply(this,[this.aOrderedCards,this.aManifestOrderedCards]);this.aOrderedCards=this.aManifestOrderedCards;this._resetDashboardLayout();this._updateDashboardLayoutCards(this.aOrderedCards);this._updateLayoutWithOrderedCards();this.oDialog.close();}.bind(this));}}.bind(this)});}.bind(this)});this.oDialog=new sap.m.Dialog({title:this._getLibraryResourceBundle().getText("hideCardsBtn_title"),contentWidth:"29.6rem",contentHeight:"50%",stretch:sap.ui.Device.system.phone,content:o,buttons:[r,s,b],afterClose:function(){this.oDialog.destroy();}.bind(this)}).addStyleClass("sapOVPCardsVisibilityDialog");var d=jQuery.extend(true,[],this.aOrderedCards);m=new sap.ui.model.json.JSONModel({cards:d});this.oDialog.setModel(m);this.oDialog.open();},isDragAndDropEnabled:function(){return!sap.ui.Device.system.phone;},getGlobalFilter:function(){if(!this.oGlobalFilter){this.oGlobalFilter=this.getView().byId("ovpGlobalFilter");}return this.oGlobalFilter;},_parseNavigationVariant:function(){this.oNavigationHandler=this.oNavigationHandler||new sap.ui.generic.app.navigation.service.NavigationHandler(this);this.oParseNavigationPromise=this.oNavigationHandler.parseNavigation();sap.ovp.cards.CommonUtils.enable(this,this.oNavigationHandler);},_setNavigationVariantToGlobalFilter:function(a,u,n){if(n==="iAppState"){var g=this.getGlobalFilter();if(g){var s=new sap.ui.generic.app.navigation.service.SelectionVariant(a.selectionVariant);var S=s.getParameterNames().concat(s.getSelectOptionsPropertyNames());for(var i=0;i<S.length;i++){g.addFieldToAdvancedArea(S[i]);}if(!this.filterChanged){g.clearVariantSelection();if(a.selectionVariant){var c=JSON.parse(a.selectionVariant);var v=c["SelectionVariantID"];g.setCurrentVariantId(v);var b=g.getDataSuiteFormat();g.setDataSuiteFormat(a.selectionVariant,true);var A=g.getDataSuiteFormat();if(b===A){g.getSmartVariant().currentVariantSetModified(false);}else{g.getSmartVariant().currentVariantSetModified(true);}}}}}},onAssignedFiltersChanged:function(e){if(e.getSource()&&this.getView().byId("ovpFilterText")){this.getView().byId("ovpFilterText").setText(e.getSource().retrieveFiltersWithValuesAsText());}}});}());
