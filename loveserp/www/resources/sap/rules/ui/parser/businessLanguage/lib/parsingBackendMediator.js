jQuery.sap.declare("sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.constants");jQuery.sap.require("sap.rules.ui.parser.resources.dependencies.lib.constantsBase");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseModel");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parseUtils");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.parameterRuntimeServices");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.IDPLexer");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.IDPParser");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.parserTokens");jQuery.sap.require("sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderFactory");sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator=sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator||{};sap.rules.ui.parser.businessLanguage.lib.parsingBackendMediator.lib=(function(){var p=sap.rules.ui.parser.businessLanguage.lib.parseUtils.lib;var a=new p.parseUtilsLib();var c=sap.rules.ui.parser.businessLanguage.lib.constants.lib;var d=sap.rules.ui.parser.resources.dependencies.lib.constantsBase.lib;var b=sap.rules.ui.parser.businessLanguage.lib.parseModel.lib;var e=new b.parseModelLib();var f=sap.rules.ui.parser.resources.vocabulary.lib.parameterRuntimeServices;var g=sap.rules.ui.parser.businessLanguage.lib.autoCompleteUtils.lib;var h=new g.autoCompleteUtilsLib();var v=sap.rules.ui.parser.resources.vocabulary.lib.vocabularyDataProviderFactory.lib;var r=new v.vocaDataProviderFactoryLib();var I=sap.rules.ui.parser.businessLanguage.lib.IDPLexer.lib;var i=sap.rules.ui.parser.businessLanguage.lib.IDPParser.lib;var o=sap.rules.ui.parser.businessLanguage.lib.antlr3_all_min.lib;var j=sap.rules.ui.parser.businessLanguage.lib.parserTokens.lib;function k(){}k.prototype.getRELType=function getRELType(l,m){var t;t=(l===undefined||l===null)?c.TYPE_ALL:l;if(m!==null&&m!==undefined&&m[c.propertiesEnum.isCollection]===true){t=a.getCollectionRelTypeFromBusinessDT(t);}return t;};k.prototype.parseExpression=function(l,m,q,s,t,u,w){try{jQuery.sap.log.debug("ParsingBackendMediator expression to parse: "+l);var x=e.createModelManger();x.vocaRTServ=q;x.vocabulary=u;x.mode=m;x.paramServ=s;x.flags=(w===undefined||w===null)?{}:w;t=this.getRELType(t,w);var y=l;if(l!==null&&(l!==undefined)){l=l.toString();l=l.replace(/(\r\n|\n|\r)/gm," ");}if(l===null||l===undefined||a.isBlank(l)){var z={};z.status=c.statusEnum.SUCCESS;if(m===c.TOKEN_TYPES||(x.flags.hasOwnProperty(c.propertiesEnum.tokens)&&x.flags[c.propertiesEnum.tokens]===true)){z.tokens=[];if(l!==null&&l!==undefined){var n=y.length;var C=new a.TokenInfo(y,c.tokenTypesEnum.whitespace,null,0,n);z.tokens.push(C);}}if(m===c.VALIDATE_MODE||m===c.PARSE_MODE){z.errorDetails=null;z.model=null;z.cursorPosition=null;z.actualReturnType=c.TYPE_ALL;if(x.flags.hasOwnProperty(c.propertiesEnum.conversionOutput)&&((x.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toKeys)||(x.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toDescriptions))){z.convertedExpression=y;}return z;}else if(m===c.TOKEN_TYPES){return z;}}x.expression=l;var D=new o.antlr.runtime.ANTLRStringStream(l);var E=new I(D);E.displayRecognitionError=function(A,B){var L=E.getErrorHeader(B);var M=E.getErrorMessage(B,A);a.handleWarning(L+" "+M);};var F=new o.antlr.runtime.CommonTokenStream(E);var G=new i(F);G.mode=m;G.displayRecognitionError=function(A,B){var L=G.getErrorHeader(B);var M=G.getErrorMessage(B,A);a.handleWarning(L+" "+M);};var H={};var J={};switch(m){case c.AUTOCOMPLETE_MODE:case c.AUTOCOMPLETE_MODE_LOWERCASE:jQuery.sap.log.debug("mode autocomplete");H.suggs=JSON.parse(h.getNextSuggestions(l,E,G,q,t));if(x.flags.hasOwnProperty(c.propertiesEnum.tokens)&&x.flags[c.propertiesEnum.tokens]===true){H.tokens=a.buildTokenTypes(G,y,x);}jQuery.sap.log.debug("ParsingBackendMediator: autocomplete responseObject: "+H);return H;case c.PARSE_MODE:case c.VALIDATE_MODE:jQuery.sap.log.debug("mode validate");a.parseWithValidation(E,G,t,e.getModelManger());H=e.getModelManger().parseResult.getParseResults();if(x.flags.hasOwnProperty(c.propertiesEnum.tokens)&&x.flags[c.propertiesEnum.tokens]===true){H.tokens=a.buildTokenTypes(G,y,x);}if(x.flags.hasOwnProperty(c.propertiesEnum.conversionOutput)&&((x.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toKeys)||(x.flags[c.propertiesEnum.conversionOutput]===c.conversionOutputEnum.toDescriptions))){J=H.tokens||a.buildTokenTypes(G,y,x);H.convertedExpression=a.convertValueList(q,u,x,J,y);}if(x.flags.hasOwnProperty(c.propertiesEnum.rootObjectContext)&&x.flags[c.propertiesEnum.rootObjectContext]===true){H.rootObjectContext=null;if(H.status===c.statusEnum.SUCCESS){H.rootObjectContext={};H.rootObjectContext.name=x[c.propertiesEnum.rootObjectContext].name;H.rootObjectContext.associations=x[c.propertiesEnum.rootObjectContext].assocs;}}return H;case c.TOKEN_TYPES:jQuery.sap.log.debug("mode token types");a.parseWithValidation(E,G,t,e.getModelManger());H.tokens=a.buildTokenTypes(G,y,x);H.status=c.statusEnum.SUCCESS;return H;default:a.handleError("Unknown mode",null,e.getModelManger());H=e.getModelManger().parseResult.getParseResults();return H;}}catch(K){e.getModelManger().parseResult.status=c.statusEnum.ERROR;jQuery.sap.log.error("ParsingBackendMediator error: "+K);return e.getModelManger().parseResult.getParseResults();}};k.prototype.convertExpressionToKeys=function(l,m,n,t,q,s){var u={};if(s){u=s;}u[c.propertiesEnum.conversionOutput]=c.conversionOutputEnum.toKeys;return this.parseExpression(l,c.VALIDATE_MODE,m,n,t,q,u);};k.prototype.convertExpressionToDescriptions=function(l,m,n,t,q,s){var u={};if(s){u=s;}u[c.propertiesEnum.conversionOutput]=c.conversionOutputEnum.toDescriptions;return this.parseExpression(l,c.VALIDATE_MODE,m,n,t,q,u);};k.prototype.parseInputRT=function(l,m,n,q,t,s,u){var w=null;if(q){w=new f.ParameterRuntimeServices(q,n,s);}return this.parseExpression(l,m,n,w,t,s,u);};k.prototype.parseInput=function(l,m,n,q,t,s,u){var w=null;w=r.getVocabularyDataProvider();return this.parseInputRT(l,m,w,q,t,s,u);};k.prototype.isReservedWord=function(s){var m=e.getModelManger();m.clearModelData();m.parseResult.clear();s=s.split(' ')[0];var l=new o.antlr.runtime.ANTLRStringStream(s);var n=new I(l);var t=new o.antlr.runtime.CommonTokenStream(n);var q=new i(t);var u=true;q.reportError=function(A){if((q.input.tokens.length>0)&&(q.input.tokens[0].type===j.NAVIGATION||q.input.tokens[0].type===j.TYPEATTRIBUTE||q.input.tokens[0].type===j.INT||q.input.tokens[0].type===j.STRING||q.input.tokens[0].type===j.ANYCHAR||q.input.tokens[0].type===undefined||q.input.tokens[0].type===null)){u=false;}};n.reportError=function(A){if((q.input.tokens.length>0)&&(q.input.tokens[0].type===j.NAVIGATION||q.input.tokens[0].type===j.TYPEATTRIBUTE||q.input.tokens[0].type===j.INT||q.input.tokens[0].type===j.STRING||q.input.tokens[0].type===undefined||q.input.tokens[0].type===null)){u=false;}};q.dummyRule();return u;};k.prototype.validateAndGetExpressionActualReturnTypeRT=function(l,m,n,q,s,t){var u={type:null,dataObject:null,businessDataType:null,unknownTokens:{},isCollection:false,errorDetails:null,isValid:false,dependenciesOutput:{}};if(q===undefined){q=null;}var w;if(t){w=t;}else{w={};w[c.propertiesEnum.unknownTokens]=true;w[d.PROPERTY_NAME_DEPENDENCIES_OUTPUT]=true;}if(s!==undefined&&s===false){w[c.propertiesEnum.raiseError]=false;}var x=this.parseExpression(m,c.VALIDATE_MODE,l,q,c.TYPE_ALL,n,w);if(x.actualReturnType){jQuery.sap.log.debug(x.actualReturnType);}if(x.status===c.statusEnum.ERROR){u.errorDetails=x.errorDetails;u.unknownTokens=x[c.propertiesEnum.unknownTokens];return u;}u.type=x.actualReturnType;u.dataObject=(x.hasOwnProperty(c.attributesNamesEnum.dataObject)?x.dataObject:null);u.isValid=true;var y=a.getBusinessDTFromRelType(u.type);u.isCollection=y[c.propertiesEnum.isCollection];u.businessDataType=y[c.propertiesEnum.businessType];u.dependenciesOutput=(x.hasOwnProperty(d.PROPERTY_NAME_DEPENDENCIES_OUTPUT)?x.dependenciesOutput:{});if(x.hasOwnProperty(c.propertiesEnum.convertedExpression)){u.convertedExpression=x.convertedExpression;}return u;};k.prototype.validateAndGetExpressionActualReturnType=function(l,m,n,q,s,t){var u=null;var w=null;u=r.getVocabularyDataProvider();if(l){if(q){w=new f.ParameterRuntimeServices(q,u,n);}}return this.validateAndGetExpressionActualReturnTypeRT(u,m,n,w,s,t);};k.prototype.validateExpression=function(l,m,n,q,t,s){var u=this.parseInput(m,q,l,s,t,n);var w={status:u.status,errorDetails:u.errorDetails};return w;};k.prototype.validateAndGetExpressionModel=function(l,m,n,q,t,s){var u=this.parseInput(m,q,l,s,t,n);return u.model;};k.prototype.getRELDependencies=function(l,m,n,q){var s={};s[d.PROPERTY_NAME_DEPENDENCIES_OUTPUT]=true;var t=this.parseInput(m,c.VALIDATE_MODE,l,q,c.TYPE_ALL,n,s);return t[d.PROPERTY_NAME_DEPENDENCIES_OUTPUT];};k.prototype.handleParse=function(l){if(!l.hasOwnProperty("expression")){return e.getModelManger().parseResult.getParseResults();}if(!l.hasOwnProperty("vocabulary")){l.vocabulary=null;}if(!l.hasOwnProperty("mode")){l.mode=c.VALIDATE_MODE;}if(!l.hasOwnProperty("returnType")){l.returnType=c.TYPE_ALL;}if(!l.hasOwnProperty("parameters")){l.parameters=null;}if(!l.hasOwnProperty(c.propertiesEnum.flags)){l.flags={};}return this.parseInput(l.expression,l.mode,l.connection,l.parameters,l.returnType,l.vocabulary,l.flags);};return{parsingBackendMediatorLib:k};}());
