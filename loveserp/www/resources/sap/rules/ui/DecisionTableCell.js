/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/rules/ui/DecisionTableCellExpressionAdvanced"],function(q,l,D){"use strict";var a=sap.ui.core.Control.extend("sap.rules.ui.DecisionTableCell",{metadata:{library:"sap.rules.ui",properties:{valuePath:{type:"string",defaultValue:"",bindable:"bindable"},headerValuePath:{type:"string",defaultValue:"",bindable:"bindable"},fixedOperatorPath:{type:"string",defaultValue:"",bindable:"bindable"},typePath:{typePath:"string",bindable:"bindable"},valueStateTextPath:{type:"string",defaultValue:"null",bindable:"bindable"},editable:{type:"boolean",defaultValue:true},inFocus:{type:"boolean",defaultValue:false}},aggregations:{_displayedControl:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{expressionLanguage:{type:"sap.rules.ui.services.ExpressionLanguage",multiple:false,validateOnLoad:true,singularName:"expressionLanguage"}}}});a.prototype.onFocusOut=function(){this.setInFocus(false);};a.prototype.onClick=function(){this.setInFocus(true);};a.prototype.onFocusIn=function(){this.setInFocus(true);};a.prototype.onBeforeRendering=function(){this._setDisplayedControl();};a.prototype.onAfterRendering=function(){};a.prototype._setDisplayedControl=function(){var d=this.getAggregation("_displayedControl");if(this.getInFocus()){d=this._createExpressionEditor();}else{d=this._createStaticControl();}this.setAggregation("_displayedControl",d,true);};a.prototype._createStaticControl=function(){var m=this;var d=this.getAggregation("_displayedControl");if(!(d instanceof sap.m.Input)){if(d){d.destroy();}d=new sap.m.Input({editable:false});d.addDelegate({onfocusin:function(e){m.onFocusIn();}});d.addDelegate({onclick:function(e){m.onFocusIn();}});}var v=this.getValuePath();if(v&&v!=="null"){d.bindValue(v);}var b=this.getValueStateTextPath();if(b&&b!=="null"){d.bindProperty("valueState",{path:b,formatter:function(V){if(V){d.addStyleClass("sapMInputBaseErrorInner");return sap.ui.core.ValueState.Error;}d.removeStyleClass("sapMInputBaseErrorInner");return sap.ui.core.ValueState.None;}});}return d;};a.prototype._createExpressionEditor=function(){var m=this;var e=new D({editable:this.getEditable(),expressionLanguage:this.getExpressionLanguage(),focusOnLoad:true});var v=this.getValuePath();if(v&&v!=="null"){e.bindValue(v);}if(this.getTypePath()){e.bindType(this.getTypePath());}if(this.getHeaderValuePath()){e.bindHeaderValue(this.getHeaderValuePath());if(this.getFixedOperatorPath()){e.bindFixedOperator(this.getFixedOperatorPath());}}var b=this.getValueStateTextPath();if(b&&b!=="null"){e.bindValueStateText(b);}e.addDelegate({onfocusout:function(E){if(!m.getAggregation("_displayedControl").codeMirror||(m.getAggregation("_displayedControl").codeMirror.state&&m.getAggregation("_displayedControl").codeMirror.state.completionActive)){return;}var r=E.relatedTarget;var u=window.navigator.userAgent;var c=u.indexOf("MSIE ");if(r){if(r.id&&(c>0||!!navigator.userAgent.match(/Trident.*rv\:11\./))&&r.id==="content"){return;}}m.onFocusOut();}});return e;};return a;},true);
