sap.ui.define([],function(){"use strict";var L=function(u,c){this.uiModel=u;this.setColCount(c);this.aCards=[];this.oLayoutVars=null;this.oUndoBuffer={};this.bSequenceLayout=null;this.oCurrLayoutVar=null;this.sManifestLayoutsJSON=null;this.iDisplaceRow=9999;};L.prototype.setColCount=function(c){if(!c){this.iColCount=5;}else if(c!==this.iColCount){if(this.bLayoutChanged){this._updateCurrentLayoutVariant();this.oUndoBuffer={};this.bLayoutChanged=false;}this.iColCount=c;}};L.prototype.setLayoutVars=function(l){var a=null;var c=null;if(this.oCurrLayoutVar&&this.oCurrLayoutVar.__ovpDBLVarId){c=this.oCurrLayoutVar.__ovpDBLVarId;}for(a in l){if(l.hasOwnProperty(a)&&l[a]){this.oLayoutVars[a]=l[a];}}if(c){this.oCurrLayoutVar=this.oLayoutVars[c];}this._buildGrid();this.condenseEmptyRows();};L.prototype.setManifestLayoutsJSON=function(m){this.sManifestLayoutsJSON=m;};L.prototype.updateCardVisibility=function(c){var i=0;var l;var a;this.oLayoutVars["C"+this.iColCount]=this.extractCurrentLayoutVariant();for(i=0;i<c.length;i++){for(l in this.oLayoutVars){if(this.oLayoutVars[l].hasOwnProperty(c[i].id)){a=this.oLayoutVars[l];if(a[c[i].id].hasOwnProperty("visible")&&a[c[i].id].visible===false&&c[i].visibility){a[c[i].id].col=0;a[c[i].id].row=0;}a[c[i].id].visible=c[i].visibility;}}this.oCurrLayoutVar=this.oLayoutVars["C"+this.iColCount];}this._setCardsLayoutFromVariant(this.aCards,this.oCurrLayoutVar);this.condenseEmptyRows();};L.prototype.getColCount=function(){return this.iColCount;};L.prototype.getCards=function(c){if(this.aCards.length===0||c&&c!==this.iColCount){if(c){this.setColCount(c);}this._buildGrid();}return this.aCards;};L.prototype.getCardById=function(c){var C=null;var i=0;for(i=0;i<this.aCards.length;i++){C=this.aCards[i];if(C.id===c){break;}}return C;};L.prototype.getCardsByGrid=function(g,a){var c={};var i=0;var C={};var m=[];for(i=0;i<this.aCards.length;i++){C=this.aCards[i];if(C.id===a||!C.dashboardLayout.visible){continue;}c.y1=C.dashboardLayout.row;c.x1=C.dashboardLayout.column;c.y2=C.dashboardLayout.row+C.dashboardLayout.rowSpan-1;c.x2=C.dashboardLayout.column+C.dashboardLayout.colSpan-1;if(this._checkOverlap(c,g)){m.push(C);}}return m;};L.prototype.getLayoutVariants4Pers=function(){var v=null;var p=JSON.parse(JSON.stringify(this.oLayoutVars));for(v in p){if(p[v].__ovpDBLVarSource==="auto"||p[v].__ovpDBLVarSource==="manifest"){delete p[v];}}return p;};L.prototype.getCardByGridPos=function(g){this._sortCardsByCol(this.aCards);var i=0;var c={};for(i=0;i<this.aCards.length;i++){c=this.aCards[i];if(c.dashboardLayout.column<=g.column&&(c.dashboardLayout.column+c.dashboardLayout.colSpan-1)>=g.column&&c.dashboardLayout.row<=g.row&&(c.dashboardLayout.row+c.dashboardLayout.rowSpan-1)>=g.row){return c;}}};L.prototype._readVariants=function(u){var v={};this.oLayoutVars={};var l=null;if(!this.sManifestLayoutsJSON){l=this.uiModel.getProperty("/dashboardLayout");if(l){this.sManifestLayoutsJSON=JSON.stringify(l);}}if(u){l=JSON.parse(this.sManifestLayoutsJSON);}else{l=this.uiModel.getProperty("/dashboardLayout");}this.bSequenceLayout=true;if(!l){return;}for(var a in l){if(l.hasOwnProperty(a)&&l[a]){v=l[a];v.id=a;if(u){v.__ovpDBLVarSource="manifest";v.__ovpDBLVarId="C"+parseInt(v.id.replace(/[^0-9\.]/g,""),10);}this.oLayoutVars["C"+parseInt(v.id.replace(/[^0-9\.]/g,""),10)]=v;this.bSequenceLayout=false;}}};L.prototype.resetToManifest=function(){this.oCurrLayoutVar=null;this.oLayoutVars=null;this._buildGrid(true);};L.prototype._buildGrid=function(u){var i=0;var l=null;if(this.aCards.length===0){this.aCards=this.uiModel.getProperty("/cards");}if(!this.oLayoutVars||u){this._readVariants(u);}if(this.bSequenceLayout){this._sliceSequenceSausage();l=this.oLayoutVars["C"+this.iColCount];l.__ovpDBLVarSource="auto";this.bSequenceLayout=false;}else if(this.oLayoutVars["C"+this.iColCount]){l=this.oLayoutVars["C"+this.iColCount];}else if(this.oCurrLayoutVar){this._sliceSequenceSausage(this.oCurrLayoutVar);l=this.oLayoutVars["C"+this.iColCount];l.__ovpDBLVarSource="auto";}else{for(i=this.iColCount;i>0;i--){if(this.oLayoutVars["C"+i]){this._sliceSequenceSausage(this.oLayoutVars["C"+i]);l=this.oLayoutVars["C"+this.iColCount];l.__ovpDBLVarSource="auto";break;}}}if(!l){for(var o in this.oLayoutVars){this._sliceSequenceSausage(this.oLayoutVars[o]);l=this.oLayoutVars["C"+this.iColCount];l.__ovpDBLVarSource="auto";break;}}this.oCurrLayoutVar=l;this._setCardsLayoutFromVariant(this.aCards,this.oCurrLayoutVar);this._sortCardsByCol(this.aCards);};L.prototype._setCardsLayoutFromVariant=function(c,l){var C={};var o={};var i=0;var b=false;for(i=0;i<c.length;i++){C=c[i];o=l[C.id];if(o){C.dashboardLayout={};if(o.colSpan){C.dashboardLayout.colSpan=o.colSpan;}else{C.dashboardLayout.colSpan=1;}if(o.rowSpan){C.dashboardLayout.rowSpan=o.rowSpan;}else{C.dashboardLayout.rowSpan=1;}if(o.hasOwnProperty("visible")&&o.visible===false){C.dashboardLayout.column=0;C.dashboardLayout.row=0;C.dashboardLayout.visible=false;b=true;}else{C.dashboardLayout.visible=true;if(o.col===0||o.row===0){this._displaceCardToEnd(C);b=true;}else{C.dashboardLayout.column=o.col;C.dashboardLayout.row=o.row;}if(o.autoSpan){C.dashboardLayout.autoSpan=o.autoSpan;}if(C.dashboardLayout.colSpan>this.iColCount){C.dashboardLayout.colSpan=this.iColCount;}}}else{this._setCardSpanFromDefault(C);this._displaceCardToEnd(C);b=true;l[C.id]={col:C.dashboardLayout.column,row:C.dashboardLayout.row,colSpan:C.dashboardLayout.colSpan,rowSpan:C.dashboardLayout.rowSpan};l.__ovpDBLVarSource="auto";}if(C.dashboardLayout.column>this.iColCount){this._displaceCardToEnd(C);b=true;jQuery.sap.log.warning("DashboardLayout: card ("+C.id+") in invalid column -> moved to end");}if(C.dashboardLayout.column+C.dashboardLayout.colSpan-1>this.iColCount){C.dashboardLayout.colSpan=Math.min(C.dashboardLayout.colSpan,this.iColCount);this._displaceCardToEnd(C);b=true;jQuery.sap.log.warning("DashboardLayout: card ("+C.id+") too wide -> moved to end");}}if(b){this.condenseEmptyRows();}this.validateGrid(true);};L.prototype._displaceCardToEnd=function(c){c.dashboardLayout.column=1;c.dashboardLayout.row=this.iDisplaceRow;this.iDisplaceRow+=c.dashboardLayout.rowSpan;};L.prototype._setCardSpanFromDefault=function(c){if(!c.dashboardLayout){c.dashboardLayout={};}if(!c.settings.defaultSpan||c.settings.defaultSpan==="auto"){c.dashboardLayout.autoSpan=true;c.dashboardLayout.colSpan=1;c.dashboardLayout.rowSpan=1;}else{if(c.settings.defaultSpan&&c.settings.defaultSpan.cols){c.dashboardLayout.colSpan=Math.min(c.settings.defaultSpan.cols,this.iColCount);}else{c.dashboardLayout.colSpan=1;}if(c.settings.defaultSpan&&c.settings.defaultSpan.rows){c.dashboardLayout.rowSpan=c.settings.defaultSpan.rows;}else{c.dashboardLayout.rowSpan=1;}}};L.prototype._sliceSequenceSausage=function(u){var i=0;var j=0;var c=0;var C=0;var m=0;var o={};var s=[];if(!u){this._sortCardsSausage(this.aCards);}for(i=0;i<this.iColCount;i++){s.push({col:i+1,rows:0});}for(i=0;i<this.aCards.length;i++){o=this.aCards[i];if(!o.dashboardLayout){o.dashboardLayout={};}if(!u||!u.hasOwnProperty(o.id)){this._setCardSpanFromDefault(o);}else{if(u[o.id].hasOwnProperty("visible")){o.dashboardLayout.visible=u[o.id].visible;}if(u[o.id].colSpan&&u[o.id].colSpan>0){o.dashboardLayout.colSpan=u[o.id].colSpan;}else{o.dashboardLayout.colSpan=1;}if(u[o.id].rowSpan&&u[o.id].rowSpan>0){o.dashboardLayout.rowSpan=u[o.id].rowSpan;}else{o.dashboardLayout.rowSpan=1;}}if(o.dashboardLayout.hasOwnProperty("visible")&&o.dashboardLayout.visible===false){o.dashboardLayout.column=0;o.dashboardLayout.row=0;continue;}else if(!o.dashboardLayout.hasOwnProperty("visible")){o.dashboardLayout.visible=true;}if(o.dashboardLayout.colSpan>this.iColCount){o.dashboardLayout.colSpan=this.iColCount;}if(C<this.iColCount){c=C+1;}else{c=1;}if(c+o.dashboardLayout.colSpan-1>this.iColCount){c=1;}C=c+o.dashboardLayout.colSpan-1;o.dashboardLayout.column=c;m=0;for(j=o.dashboardLayout.column;j<o.dashboardLayout.column+o.dashboardLayout.colSpan;j++){if(s[j-1].rows>m){m=s[j-1].rows;}}o.dashboardLayout.row=m+1;for(j=o.dashboardLayout.column;j<o.dashboardLayout.column+o.dashboardLayout.colSpan;j++){s[j-1].rows=m+o.dashboardLayout.rowSpan;}}this.oLayoutVars["C"+this.iColCount]=this.extractCurrentLayoutVariant();};L.prototype._sortCardsSausage=function(c){c.sort(function(a,b){if(a.sequencePos&&b.sequencePos){if(a.sequencePos<b.sequencePos){return-1;}else if(a.sequencePos>b.sequencePos){return 1;}else{return 0;}}else if(a.sequencePos&&!b.sequencePos){return-1;}else if(!a.sequencePos&&b.sequencePos){return 1;}else{if(a.id<b.id){return-1;}else if(a.id>b.id){return 1;}else{return 0;}}});};L.prototype._sortCardsByCol=function(c){c.sort(function(a,b){if(!a.dashboardLayout&&b.dashboardLayout){return 1;}else if(a.dashboardLayout&&!b.dashboardLayout){return-1;}if(a.dashboardLayout.column&&a.dashboardLayout.row&&a.dashboardLayout.column===b.dashboardLayout.column){if(a.dashboardLayout.row<b.dashboardLayout.row){return-1;}else if(a.dashboardLayout.row>b.dashboardLayout.row){return 1;}}else if(a.dashboardLayout.column){return a.dashboardLayout.column-b.dashboardLayout.column;}else{return 0;}});};L.prototype._sortCardsByRow=function(c){c.sort(function(a,b){if(!a.dashboardLayout&&b.dashboardLayout){return 1;}else if(a.dashboardLayout&&!b.dashboardLayout){return-1;}if(a.dashboardLayout.column&&a.dashboardLayout.row&&a.dashboardLayout.row===b.dashboardLayout.row){if(a.dashboardLayout.column<b.dashboardLayout.column){return-1;}else if(a.dashboardLayout.column>b.dashboardLayout.column){return 1;}}else if(a.dashboardLayout.row){return a.dashboardLayout.row-b.dashboardLayout.row;}else{return 0;}});};L.prototype._checkOverlap=function(a,b){var x,y=false;if((a.x1>=b.x1&&a.x1<=b.x2)||(a.x2>=b.x1&&a.x2<=b.x2)||(b.x1>=a.x1&&b.x2<=a.x2)){x=true;}if((a.y1>=b.y1&&a.y1<=b.y2)||(a.y2>=b.y1&&a.y2<=b.y2)||(b.y1>=a.y1&&b.y2<=a.y2)){y=true;}return(x&&y);};L.prototype.undoLastChange=function(){if(this.oUndoBuffer.layoutVariant){this.oLayoutVars["C"+this.iColCount]=this.oUndoBuffer.layoutVariant;this.oUndoBuffer={};}};L.prototype.moveCardToGrid=function(f,c,p,F,i){if(!i){this._registerChange("move");}var a=[];var C=[];var o=null;if(F){o=F;}else{o=this.getCardById(f);}if(!o){return[];}if(c.column<1||c.column+o.dashboardLayout.colSpan-1>this.iColCount){return[o];}o.dashboardLayout.column=c.column;o.dashboardLayout.row=c.row;var g={x1:o.dashboardLayout.column,y1:o.dashboardLayout.row,x2:o.dashboardLayout.column+o.dashboardLayout.colSpan-1,y2:o.dashboardLayout.row+o.dashboardLayout.rowSpan-1};var O=this.getCardsByGrid(g,o.id);var P=this._getPushGrid(O);var I={};if(p){I.rowSpan=P.rowSpan;I.colSpan=o.dashboardLayout.column+o.dashboardLayout.colSpan-P.column;}else{I.rowSpan=o.dashboardLayout.row+o.dashboardLayout.rowSpan-P.row;I.colSpan=P.colSpan;}a=this._pushCards({column:P.column,row:P.row},I,o.id,p,O);if(!i){C=this.condenseEmptyRows();if(C.length>0){a=a.concat(C);a=this.condenseCardArray(a);}}return a;};L.prototype._getPushGrid=function(c){var p={};var i=0;var m=99999;var a=1;var b=this.iColCount;var d=1;if(!c&&c.length===0){return p;}for(i=0;i<c.length;i++){if(c[i].dashboardLayout.row<m){m=c[i].dashboardLayout.row;}if(c[i].dashboardLayout.row+c[i].dashboardLayout.rowSpan-1>a){a=c[i].dashboardLayout.row+c[i].dashboardLayout.rowSpan-1;}if(c[i].dashboardLayout.column<b){b=c[i].dashboardLayout.column;}if(c[i].dashboardLayout.column+c[i].dashboardLayout.colSpan-1>d){d=c[i].dashboardLayout.column+c[i].dashboardLayout.colSpan-1;}}p.column=b;p.row=m;p.colSpan=d-b+1;p.rowSpan=a-m+1;return p;};L.prototype._updateGapDelta=function(g){if(g.cardLayout[g.axis]>g.curr){g.curr=g.cardLayout[g.axis];if(g.max>0&&g.curr>g.max+1){g.delta+=g.curr-1-g.max;}g.max=g.cardLayout[g.axis]+g.cardLayout[g.span]-1;}else{if(g.cardLayout[g.axis]+g.cardLayout[g.span]-1>g.max){g.max=g.cardLayout[g.axis]+g.cardLayout[g.span]-1;}}};L.prototype._pushCards=function(u,I,f,p,o){var i=0;var j=0;var n=0;var N=0;var e=0;var g={curr:0,max:0,delta:0};var a={column:u.column,row:u.row};var A=[];var P=[];if(p){var F=[];g.axis="column";g.span="colSpan";g.curr=u.column-1;g.max=u.column-1;a.rowSpan=I.rowSpan;a.colSpan=0;if(o&&o.length>0){for(j in o){if(o[j].dashboardLayout){A=A.concat(this._getHorizontalFollower(o[j].dashboardLayout,f));}}A=this.condenseCardArray(A);}else{A=this._getHorizontalFollower(a,f);}for(i=0;i<A.length;i++){g.cardLayout=A[i].dashboardLayout;this._updateGapDelta(g);n=A[i].dashboardLayout.column+I.colSpan-g.delta;N=n+A[i].dashboardLayout.colSpan-1;if(n>A[i].dashboardLayout.column){if(N<=this.iColCount){A[i].dashboardLayout.column=n;e=A[i].dashboardLayout.row+A[i].dashboardLayout.rowSpan-1;}else{F.push(A[i]);}}}if(F.length>0){if(e===0){var b=this.getCardById(f);if(b){e=b.dashboardLayout.row+b.dashboardLayout.rowSpan-1;}else{e=a.row+a.rowSpan-1;}}P=this._pushFallDownCards(e+1,f,F);if(P.length>0){A=this.condenseCardArray(A.concat(P));}}}else{g.axis="row";g.span="rowSpan";g.curr=u.row-1;g.max=u.row-1;a.rowSpan=0;a.colSpan=I.colSpan;if(o&&o.length>0){for(j in o){if(o[j].dashboardLayout){A=A.concat(this._getVerticalFollower(o[j].dashboardLayout,f));}}A=this.condenseCardArray(A);this._sortCardsByRow(A);}else{A=this._getVerticalFollower(a,f);}for(i=0;i<A.length;i++){g.cardLayout=A[i].dashboardLayout;this._updateGapDelta(g);n=A[i].dashboardLayout.row+I.rowSpan-g.delta;if(n>A[i].dashboardLayout.row){A[i].dashboardLayout.row=n;}}}return A;};L.prototype.resizeCard=function(c,s,m){this._registerChange("resize");var r=this.getCardById(c);if(!r){return[];}var d=s.colSpan-r.dashboardLayout.colSpan;var a=s.rowSpan-r.dashboardLayout.rowSpan;if(d===0&&a===0){return{resizeCard:r,affectedCards:[]};}else if(m&&r.dashboardLayout.autoSpan){r.dashboardLayout.autoSpan=false;}var A=[];var b=[];if(d>0){if(a<0){A=this._pushCards({column:r.dashboardLayout.column+r.dashboardLayout.colSpan,row:r.dashboardLayout.row},{colSpan:d,rowSpan:s.rowSpan},c,true);}else{A=this._pushCards({column:r.dashboardLayout.column+r.dashboardLayout.colSpan,row:r.dashboardLayout.row},{colSpan:d,rowSpan:s.rowSpan},c,true);}}r.dashboardLayout.colSpan=s.colSpan;if(a>0){if(d<0){b=this._pushCards({column:r.dashboardLayout.column,row:r.dashboardLayout.row+r.dashboardLayout.rowSpan},{colSpan:s.colSpan,rowSpan:a},c,false);}else{b=this._pushCards({column:r.dashboardLayout.column,row:r.dashboardLayout.row+r.dashboardLayout.rowSpan},{colSpan:s.colSpan,rowSpan:a},c,false);}}r.dashboardLayout.rowSpan=s.rowSpan;A=A.concat(b);A=this.condenseCardArray(A);b=this.condenseEmptyRows();if(b.length>0){A=A.concat(b);A=this.condenseCardArray(A);}return{resizeCard:r,affectedCards:A};};L.prototype._pushFallDownCards=function(a,b,p){var i=0;var n={};var t={};var A=[];var c=[];for(i=p.length-1;i>=0;i--){p[i].dashboardLayout.row=a;n=this._getNextPossibleRowAndColliders(a,p[i]);t.column=this.iColCount-p[i].dashboardLayout.colSpan+1;t.row=n.row;A=this.moveCardToGrid(p[i].id,t,false,p[i],true);c=c.concat(A);}c=this.condenseCardArray(c);return c;};L.prototype._getNextPossibleRowAndColliders=function(a,b){var i=0;var c;var t=a;var C=[];for(i=b.dashboardLayout.column;i<=b.dashboardLayout.column+b.dashboardLayout.colSpan-1;i++){c=this.getCardByGridPos({column:i,row:a});if(c&&c.dashboardLayout&&c.id!==b.id){if(c.dashboardLayout.row===a){C.push(c);}else if(c.dashboardLayout.row+c.dashboardLayout.rowSpan+1>t){t=c.dashboardLayout.row+c.dashboardLayout.rowSpan+1;}}}return{row:t,collidingCards:C};};L.prototype._getHorizontalFollower=function(a,f){this._sortCardsByCol(this.aCards);var h=[];var e=a.row;var b=a.row+a.rowSpan-1;var i=0;var c={};var d=0;if(a.column<=this.iColCount+a.colSpan){for(i=0;i<this.aCards.length;i++){c=this.aCards[i];if(c.id===f||!c.dashboardLayout.visible){continue;}d=c.dashboardLayout.row+c.dashboardLayout.rowSpan-1;if(c.dashboardLayout.column>=a.column&&c.dashboardLayout.row<=b&&d>=e){if(d>b){b=d;}if(c.dashboardLayout.row<e){e=c.dashboardLayout.row;}h.push(c);}}}return h;};L.prototype._getVerticalFollower=function(a,f){var v=[];this._sortCardsByRow(this.aCards);var e=a.column;var b=a.column+a.colSpan-1;var i=0;var c={};var d=0;for(i=0;i<this.aCards.length;i++){c=this.aCards[i];if(c.id===f||!c.dashboardLayout.visible){continue;}d=c.dashboardLayout.column+c.dashboardLayout.colSpan-1;if(c.dashboardLayout.row>=a.row&&c.dashboardLayout.column<=b&&d>=e){if(d>b){b=d;}if(c.dashboardLayout.column<e){e=c.dashboardLayout.column;}v.push(c);}}return v;};L.prototype.condenseCardArray=function(a){this._sortCardsByCol(a);return a.reduce(function(c,b){if(c.indexOf(b)<0){c.push(b);}return c;},[]);};L.prototype.extractCurrentLayoutVariant=function(){var i=0;var c={};var v={};for(i=0;i<this.aCards.length;i++){c=this.aCards[i];v[c.id]={col:c.dashboardLayout.column,row:c.dashboardLayout.row,colSpan:c.dashboardLayout.colSpan,rowSpan:c.dashboardLayout.rowSpan,visible:c.dashboardLayout.visible};if(c.dashboardLayout.autoSpan){v[c.id].autoSpan=c.dashboardLayout.autoSpan;}}if(this.oCurrLayoutVar&&this.oCurrLayoutVar.__ovpDBLVarSource){v.__ovpDBLVarSource=this.oCurrLayoutVar.__ovpDBLVarSource;}v.__ovpDBLVarId="C"+this.iColCount;return v;};L.prototype._updateCurrentLayoutVariant=function(){this.oCurrLayoutVar=this.extractCurrentLayoutVariant();this.oLayoutVars["C"+this.iColCount]=this.oCurrLayoutVar;};L.prototype._getCurrentLayoutVariant=function(){return this.oCurrLayoutVar;};L.prototype._registerChange=function(a){this.bLayoutChanged=true;this.oCurrLayoutVar.__ovpDBLVarSource="user";this.oUndoBuffer.action=a;this.oUndoBuffer.layoutVariant=this.extractCurrentLayoutVariant();};L.prototype._extractGrid=function(s){var f=s;var a="";if(f==="col"){a="row";}else if(f==="row"){a="col";}else{jQuery.sap.log.error("DashboardLayoutModel._getCurrentLayoutVariant: param sortBy has to be col or row!");}var c=[];var i=0;var r=0;var b=0;for(i=0;i<this.aCards.length;i++){var d=this.aCards[i].dashboardLayout;if(d.visible===false){continue;}for(r=d.row;r<d.row+d.rowSpan;r++){for(b=d.column;b<d.column+d.colSpan;b++){c.push({col:b,row:r,card:this.aCards[i]});}}}c.sort(function(e,g){if(e[f]===g[f]){if(e[a]<g[a]){return-1;}else if(e[a]>g[a]){return 1;}}else{return e[f]-g[f];}});return c;};L.prototype.validateGrid=function(r){var g=true;var i=0;var c=this._extractGrid("row");var p=c[0];var a={};var d=[];for(i=1;i<c.length;i++){a=c[i];if(a.col>this.iColCount||a.col<0){g=false;d.push(a.card);jQuery.sap.log.warning("DashboardLayout: Cell is outside (col/row): "+a.col+"/"+a.row);}if(a.col===p.col&&a.row===p.row){g=false;d.push(a.card);jQuery.sap.log.warning("DashboardLayout: Cell has two tenants (col/row//id1/id2: "+a.col+"/"+a.row+"//"+p.card.id+"/"+a.card.id);}p=a;}if(r&&d.length>0){d=this.condenseCardArray(d);for(i=0;i<d.length;i++){this._displaceCardToEnd(d[i]);}this.condenseEmptyRows();g=true;jQuery.sap.log.info("DashboardLayout: invalid grid repaired");}return g;};L.prototype.condenseEmptyRows=function(){var c=this._extractGrid("row");var i=0;var p=0;var a=0;var A=0;var b={};var d={};var e=[];for(i=0;i<c.length;i++){d=c[i];if(a!==d.row){p=a;a=d.row;if(p===0&&a>1){A+=a-1;}else if(a-p>2){A+=a-p-2;}}if(b!==d.card){if(d.row===d.card.dashboardLayout.row){d.card.dashboardLayout.row-=A;b=d.card;e.push(d.card);}}}this._updateCurrentLayoutVariant();return e;};return L;},true);
